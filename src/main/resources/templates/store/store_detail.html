<!DOCTYPE html>
<html lang="ko"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{fragments/tkk_fragment/layout}">

<head>
    <th:block layout:fragment="head">
        <!-- 공용 CSS 사용 -->
    </th:block>
</head>

<body>

<div layout:fragment="content">

    <div class="store-wrap">

        <!-- 상단 배너 -->
        <div class="store-cover"
             th:if="${store['imageUrl'] != null and !#strings.isEmpty(store['imageUrl'])}"
             th:style="|background-image:url('${store['imageUrl']}')|">
        </div>

        <div class="store-cover"
             th:if="${store['imageUrl'] == null or #strings.isEmpty(store['imageUrl'])}"
             style="background:#f1f5f9;display:flex;align-items:center;justify-content:center;
                    font-weight:800;color:#64748b;">
            매장 대표 이미지
        </div>

        <!-- 본문 -->
        <div class="store-body">

            <!-- ================= LEFT ================= -->
            <div class="store-left">

                <!-- 헤더 -->
                <div class="store-header">
                    <div>
                        <h1 th:text="${store['name']}">매장명</h1>
                        <div class="store-rating">
                            ⭐ 4.8 <span>(234)</span>
                        </div>
                    </div>

                    <!-- 찜 -->
                    <button class="heart-btn"
                            th:classappend="${liked} ? 'active' : ''"
                            th:data-store-id="${store['id']}">
                        ❤
                    </button>
                </div>

                <!-- 설명 (model에 없으므로 안전 처리) -->
                <p class="store-desc">
                    애니메이션 공식 굿즈를 취급하는 전문 매장입니다.
                </p>

                <!-- 매장 정보 -->
                <div class="store-info-box">
                    <div>📍 <span th:text="${store['address']}"></span></div>
                    <div>🕒 <span th:text="${store['openTime']}"></span></div>
                    <div>📞 <span th:text="${store['tel']}"></span></div>
                </div>

                <!-- 액션 버튼 -->
                <div class="store-actions">
                    <a class="btn-primary"
                       th:href="@{/map/route(storeId=${store['id']})}">
                        길찾기
                    </a>

                    <a class="btn-secondary"
                       th:href="'tel:' + ${store['tel']}">
                        전화하기
                    </a>
                </div>

            </div>

            <!-- ================= RIGHT ================= -->
            <aside class="store-right">
                <h3>실시간 재고 현황</h3>

                <div th:if="${#lists.isEmpty(goodsList)}"
                     style="color:#cbd5f5;font-size:13px;">
                    등록된 굿즈가 없습니다.
                </div>

                <div class="stock-row"
                     th:each="g : ${goodsList}">
                    <div class="stock-name" th:text="${g.name}">상품명</div>

                    <div class="stock-bar">
                        <span th:style="'width:' + ${g.stockQty * 2} + '%'"></span>
                    </div>

                    <div class="stock-qty"
                         th:text="${g.stockQty + '개'}">0개</div>
                </div>
            </aside>

        </div>
    </div>

</div>

<!-- SCRIPT -->
<th:block layout:fragment="script">
    <script>
        document.querySelectorAll('.heart-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                fetch(`/store/${btn.dataset.storeId}/like`, {
                    method: 'POST'
                }).then(() => {
                    btn.classList.toggle('active');
                });
            });
        });
    </script>
</th:block>

</body>
</html>