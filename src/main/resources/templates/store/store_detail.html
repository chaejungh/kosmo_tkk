<!DOCTYPE html>
<html lang="ko"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{fragments/tkk_fragment/layout}">
<head>
    <th:block layout:fragment="head">
        <style>
            /* =========================
               Store Detail (Figma-like)
               (ê¸°ì¡´ ëª¨ë¸: store(Map), goodsList(List), storeId, keyword)
            ========================= */

            .sd-page{
                width: min(1200px, 92%);
                margin: 0 auto;
                padding: 18px 0 60px;
            }

            .sd-topbar{
                display:flex;
                align-items:center;
                justify-content:space-between;
                margin-bottom: 12px;
            }
            .sd-back{
                display:inline-flex;
                align-items:center;
                gap:8px;
                font-weight:800;
                font-size:14px;
                color: rgba(0,0,0,.65);
                text-decoration:none;
            }
            .sd-back:hover{ color: rgba(0,0,0,.85); }

            /* HERO (í° ì´ë¯¸ì§€) */
            .sd-hero{
                border-radius: 18px;
                overflow: hidden;
                border: 1px solid #e5e7eb;
                box-shadow: 0 14px 40px rgba(0,0,0,.10);
                background: #f3f4f6;
                height: 420px;
                position: relative;
            }
            .sd-hero-bg{
                position:absolute;
                inset:0;
                background-size: cover;
                background-position: center;
                filter: none;
            }
            .sd-hero-fallback{
                position:absolute;
                inset:0;
                display:grid;
                place-items:center;
                background:
                        radial-gradient(1200px 480px at 20% 10%, rgba(236,72,153,.18), transparent 60%),
                        radial-gradient(900px 380px at 70% 30%, rgba(99,102,241,.12), transparent 55%),
                        linear-gradient(180deg, #f7f7fb, #eef0f8);
                color: rgba(0,0,0,.55);
            }
            .sd-hero-fallback .icon{ font-size: 34px; margin-bottom: 6px; }
            .sd-hero-fallback .text{ font-weight: 900; }

            /* ë©”ì¸ 2ì»¬ëŸ¼ */
            .sd-grid{
                margin-top: 22px;
                display:grid;
                grid-template-columns: 1fr 360px;
                gap: 24px;
                align-items:start;
            }

            /* LEFT: íƒ€ì´í‹€/íƒœê·¸ */
            .sd-titleBox{
                margin-bottom: 14px;
            }
            .sd-brandPill{
                display:inline-block;
                font-size:12px;
                padding: 4px 10px;
                border-radius: 999px;
                background: #f3f4ff;
                color: #4f46e5;
                font-weight: 900;
                margin-bottom: 8px;
            }
            .sd-name{
                font-size: 22px;
                font-weight: 900;
                letter-spacing: -0.2px;
                margin: 0 0 8px 0;
                color: #0f172a;
            }
            .sd-sub{
                font-size: 13px;
                color: rgba(15,23,42,.65);
                line-height: 1.7;
                margin: 0;
            }
            .sd-tags{
                margin-top: 10px;
                display:flex;
                flex-wrap: wrap;
                gap: 8px;
            }
            .sd-tag{
                padding: 6px 10px;
                border-radius: 999px;
                background: rgba(15,23,42,.05);
                color: rgba(15,23,42,.70);
                font-weight: 900;
                font-size: 12px;
            }

            /* ì¹´ë“œ(ê¸°ì¡´ í”„ë¡œì íŠ¸ card ëŠë‚Œ ìœ ì§€í•˜ë©´ì„œ) */
            .sd-card{
                border-radius: 16px;
                border: 1px solid #e5e7eb;
                background: #fff;
                box-shadow: 0 10px 26px rgba(0,0,0,.06);
                padding: 18px;
                margin-bottom: 18px;
            }
            .sd-card-title{
                font-weight: 900;
                color:#0f172a;
                font-size: 14px;
                margin: 0 0 14px 0;
                display:flex;
                align-items:center;
                gap: 10px;
            }
            .sd-pill{
                display:inline-block;
                font-size: 11px;
                padding: 2px 10px;
                border-radius: 999px;
                font-weight: 900;
                background: #f3f4f6;
                color: rgba(15,23,42,.75);
            }

            /* ë§¤ì¥ì •ë³´ row */
            .sd-infoRow{
                display:flex;
                gap: 12px;
                align-items:flex-start;
                padding: 10px 0;
            }
            .sd-ico{ opacity:.85; }
            .sd-label{
                font-size: 12px;
                color: rgba(15,23,42,.55);
                font-weight: 900;
                margin-bottom: 2px;
            }
            .sd-value{
                font-size: 13px;
                color: rgba(15,23,42,.82);
                font-weight: 800;
                word-break: break-word;
            }

            /* ì•¡ì…˜ ë²„íŠ¼ */
            .sd-actions{
                margin-top: 14px;
                display:grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            .sd-btn{
                display:flex;
                align-items:center;
                justify-content:center;
                height: 44px;
                border-radius: 12px;
                font-weight: 900;
                text-decoration:none;
                cursor:pointer;
                border: none;
            }
            .sd-btn-pink{ background:#ec4899; color:#fff; }
            .sd-btn-black{ background:#111827; color:#fff; }
            .sd-btn-line{
                background:#fff;
                color:#111827;
                border: 1px solid rgba(15,23,42,.14);
            }

            /* ê²€ìƒ‰ */
            .sd-search{
                display:flex;
                gap: 10px;
                align-items:center;
            }
            .sd-input{
                flex: 1;
                height: 44px;
                border-radius: 12px;
                border: 1px solid rgba(15,23,42,.12);
                padding: 0 14px;
                font-weight: 800;
                outline: none;
                font-size: 13px;
            }
            .sd-input:focus{
                border-color: rgba(236,72,153,.55);
                box-shadow: 0 0 0 4px rgba(236,72,153,.12);
            }
            .sd-searchBtn{
                height: 44px;
                padding: 0 16px;
                border-radius: 12px;
                border: none;
                background: #111827;
                color:#fff;
                font-weight: 900;
                cursor:pointer;
                font-size: 13px;
            }
            .sd-hint{
                margin-top: 8px;
                font-size: 12px;
                color: rgba(15,23,42,.55);
                font-weight: 800;
            }

            /* êµ¿ì¦ˆ í…Œì´ë¸”(ê¸°ì¡´ ê¸°ëŠ¥ ìœ ì§€) */
            .goods-table-wrap{ width:100%; overflow-x:auto; margin-top: 12px; }
            .goods-table{
                width:100%;
                border-collapse: collapse;
                font-size: 13px;
                min-width: 680px;
            }
            .goods-table th, .goods-table td{
                padding: 10px 10px;
                border-bottom: 1px solid #e5e7eb;
                white-space: nowrap;
            }
            .goods-table th{
                background:#f9fafb;
                text-align:left;
                color:#4b5563;
                font-weight: 900;
            }
            .goods-table td{ color:#0f172a; font-weight: 800; }
            .goods-thumb{
                width: 52px;
                height: 52px;
                border-radius: 12px;
                object-fit: cover;
                border: 1px solid #e5e7eb;
                background:#f3f4f6;
            }
            .goods-empty{
                padding: 16px 0;
                text-align:center;
                font-size: 13px;
                color: rgba(15,23,42,.55);
                font-weight: 800;
            }

            /* RIGHT: ì‹¤ì‹œê°„ ì¬ê³  ì¹´ë“œ */
            .sd-right{
                position: relative;
            }
            .sd-stockCard{
                position: sticky;
                top: 86px;
                border-radius: 16px;
                overflow:hidden;
                border: 1px solid rgba(15,23,42,.10);
                box-shadow: 0 14px 40px rgba(0,0,0,.10);
                background: #fff;
            }
            .sd-stockHead{
                background: #0b0f17;
                color:#fff;
                padding: 14px 14px;
                display:flex;
                align-items:center;
                gap: 10px;
            }
            .sd-stockTitle{ font-weight: 900; }
            .sd-stockBody{
                padding: 14px;
                background: #fff;
            }
            .sd-stockItem{
                padding: 12px;
                border-radius: 14px;
                border: 1px solid rgba(15,23,42,.08);
                background: rgba(15,23,42,.02);
                margin-bottom: 10px;
            }
            .sd-stockTop{
                display:flex;
                justify-content:space-between;
                align-items:center;
                gap: 10px;
            }
            .sd-stockName{
                font-weight: 900;
                font-size: 13px;
                color:#0f172a;
                overflow:hidden;
                text-overflow:ellipsis;
                white-space:nowrap;
            }
            .sd-stockCount{
                font-weight: 900;
                color:#ec4899;
                font-size: 12px;
                flex-shrink:0;
            }
            .sd-stockBar{
                height: 6px;
                border-radius: 999px;
                background: rgba(15,23,42,.10);
                overflow:hidden;
                margin-top: 10px;
            }
            .sd-stockFill{
                display:block;
                height:100%;
                width: 40%;
                border-radius: 999px;
                background: #ec4899;
            }
            .sd-stockHint{
                margin-top: 8px;
                color: rgba(15,23,42,.45);
                font-weight: 800;
                font-size: 12px;
            }

            /* ì‚¬ì§„ ê·¸ë¦¬ë“œ(í˜„ì¬ëŠ” goodsList thumbnailë¡œ êµ¬ì„±) */
            .sd-photoTitle{
                margin: 6px 0 10px;
                font-weight: 900;
                color:#0f172a;
            }
            .sd-photos{
                display:grid;
                grid-template-columns: 1fr 1fr;
                gap: 14px;
            }
            .sd-photo{
                border-radius: 16px;
                overflow:hidden;
                border: 1px solid rgba(15,23,42,.08);
                box-shadow: 0 10px 26px rgba(0,0,0,.06);
                background:#fff;
                aspect-ratio: 1 / 1;
            }
            .sd-photo img{
                width:100%;
                height:100%;
                object-fit: cover;
                display:block;
            }

            @media (max-width: 980px){
                .sd-hero{ height: 320px; }
                .sd-grid{ grid-template-columns: 1fr; }
                .sd-stockCard{ position: static; }
                .sd-photos{ grid-template-columns: 1fr; }
            }
        </style>
    </th:block>
</head>

<body>
<div layout:fragment="content">
    <main class="sd-page">

        <!-- ìƒë‹¨ -->
        <div class="sd-topbar">
            <a class="sd-back" href="javascript:history.back()">â† ëŒì•„ê°€ê¸°</a>
        </div>

        <!-- HERO (í° ì´ë¯¸ì§€) -->
        <section class="sd-hero">
            <!-- ìš°ì„ ìˆœìœ„: store.imageUrl ìˆìœ¼ë©´ / ì—†ìœ¼ë©´ ì²« êµ¿ì¦ˆ ì¸ë„¤ì¼ / ì—†ìœ¼ë©´ fallback -->
            <div class="sd-hero-bg"
                 th:if="${store.imageUrl != null and !#strings.isEmpty(store.imageUrl)}"
                 th:style="|background-image:url('${store.imageUrl}');|">
            </div>

            <div class="sd-hero-bg"
                 th:if="${(store.imageUrl == null or #strings.isEmpty(store.imageUrl)) and goodsList != null and !#lists.isEmpty(goodsList) and goodsList[0].thumbnailUrl != null}"
                 th:style="|background-image:url('${goodsList[0].thumbnailUrl}');|">
            </div>

            <div class="sd-hero-fallback"
                 th:if="${(store.imageUrl == null or #strings.isEmpty(store.imageUrl)) and (goodsList == null or #lists.isEmpty(goodsList) or goodsList[0].thumbnailUrl == null)}">
                <div>
                    <div class="icon">ğŸ¬</div>
                    <div class="text">ë§¤ì¥ ëŒ€í‘œ ì´ë¯¸ì§€ ì¤€ë¹„ì¤‘</div>
                </div>
            </div>
        </section>

        <!-- 2ì»¬ëŸ¼ -->
        <section class="sd-grid">

            <!-- LEFT -->
            <div class="sd-left">

                <!-- íƒ€ì´í‹€/íƒœê·¸ -->
                <div class="sd-titleBox">
                    <span class="sd-brandPill"
                          th:text="${store.brand != null and !#strings.isEmpty(store.brand) ? store.brand : 'ë¸Œëœë“œ'}">
                        ë¸Œëœë“œ
                    </span>

                    <h1 class="sd-name"
                        th:text="${store.name != null and !#strings.isEmpty(store.name) ? store.name : 'ë§¤ì¥ ì´ë¦„'}">
                        ë§¤ì¥ ì´ë¦„
                    </h1>

                    <p class="sd-sub" th:text="${store.address != null && !#strings.isEmpty(store.address) ? store.address : 'ì£¼ì†Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.'}">
                        ì£¼ì†Œ
                    </p>

                    <div class="sd-tags">
                        <span class="sd-tag">#ê³µì‹êµ¿ì¦ˆ</span>
                        <span class="sd-tag">#í•œì •íŒ</span>
                        <span class="sd-tag">#í…Œë§ˆë§¤ì¥</span>
                        <span class="sd-tag">#êµ¿ì¦ˆì¬ê³ </span>
                    </div>
                </div>

                <!-- ë§¤ì¥ ì •ë³´ ì¹´ë“œ + ì•¡ì…˜ -->
                <div class="sd-card">
                    <div class="sd-card-title">
                        <span>ë§¤ì¥ ì •ë³´</span>
                        <span class="sd-pill">INFO</span>
                    </div>

                    <div class="sd-infoRow">
                        <div class="sd-ico">ğŸ“</div>
                        <div>
                            <div class="sd-label">ì£¼ì†Œ</div>
                            <div class="sd-value" th:text="${store.address != null && !#strings.isEmpty(store.address) ? store.address : 'ì •ë³´ ì—†ìŒ'}">-</div>
                        </div>
                    </div>

                    <div class="sd-infoRow">
                        <div class="sd-ico">ğŸ•’</div>
                        <div>
                            <div class="sd-label">ì˜ì—…ì‹œê°„</div>
                            <div class="sd-value" th:text="${store.openTime != null && !#strings.isEmpty(store.openTime) ? store.openTime : 'ì •ë³´ ì—†ìŒ'}">-</div>
                        </div>
                    </div>

                    <div class="sd-infoRow">
                        <div class="sd-ico">ğŸ“</div>
                        <div>
                            <div class="sd-label">ì „í™”ë²ˆí˜¸</div>
                            <div class="sd-value" th:text="${store.tel != null && !#strings.isEmpty(store.tel) ? store.tel : 'ì •ë³´ ì—†ìŒ'}">-</div>
                        </div>
                    </div>

                    <div class="sd-infoRow">
                        <div class="sd-ico">ğŸ”—</div>
                        <div>
                            <div class="sd-label">í™ˆí˜ì´ì§€</div>
                            <div class="sd-value">
                                <a th:if="${store.homepage != null && !#strings.isEmpty(store.homepage)}"
                                   th:href="${store.homepage}" target="_blank"
                                   th:text="${store.homepage}"
                                   style="color:#2563eb; text-decoration:none; font-weight:900;">
                                    link
                                </a>
                                <span th:if="${store.homepage == null || #strings.isEmpty(store.homepage)}">ì •ë³´ ì—†ìŒ</span>
                            </div>
                        </div>
                    </div>

                    <div class="sd-actions">
                        <!-- âœ… ë„¤ì´ë²„ ì§€ë„ ê¸¸ì°¾ê¸° (ê¸°ì¡´ ê¸°ëŠ¥) -->
                        <a class="sd-btn sd-btn-pink"
                           th:href="@{|https://map.naver.com/p/search/${store.name}|}"
                           target="_blank">
                            ê¸¸ì°¾ê¸°
                        </a>

                        <!-- âœ… ì „í™”í•˜ê¸° -->
                        <a class="sd-btn sd-btn-black"
                           th:if="${store.tel != null && !#strings.isEmpty(store.tel)}"
                           th:href="|tel:${store.tel}|">
                            ì „í™”í•˜ê¸°
                        </a>

                        <!-- ì „í™”ë²ˆí˜¸ ì—†ì„ ë•Œ ë²„íŠ¼ ëŒ€ì²´ -->
                        <a class="sd-btn sd-btn-line"
                           th:if="${store.tel == null || #strings.isEmpty(store.tel)}"
                           href="javascript:void(0)">
                            ì „í™”ë²ˆí˜¸ ì—†ìŒ
                        </a>
                    </div>
                </div>

                <!-- êµ¿ì¦ˆ ì¬ê³  ê²€ìƒ‰/í…Œì´ë¸”(ê¸°ì¡´ ê¸°ëŠ¥ ìœ ì§€) -->
                <div class="sd-card" th:if="${goodsList != null}">
                    <div class="sd-card-title">
                        <span>ë§¤ì¥ ë‚´ êµ¿ì¦ˆ ì¬ê³  ì¡°íšŒ</span>
                        <span class="sd-pill">GOODS</span>
                    </div>

                    <form class="sd-search"
                          th:action="@{/goods/store/{storeId}(storeId=${storeId})}"
                          method="get">
                        <input class="sd-input"
                               type="text"
                               name="keyword"
                               placeholder="ì‘í’ˆëª… / ìºë¦­í„°ëª… / ìƒí’ˆëª…ìœ¼ë¡œ ê²€ìƒ‰ (ì˜ˆ: ì£¼ìˆ íšŒì „, ë£¨í”¼, ì•„í¬ë¦´ìŠ¤íƒ ë“œ)"
                               th:value="${keyword}">
                        <button class="sd-searchBtn" type="submit">ê²€ìƒ‰</button>
                    </form>

                    <div class="sd-hint">
                        * ì˜ˆì‹œ : <b>ì›í”¼ìŠ¤</b>, <b>ë‚˜ë£¨í† </b>, <b>ì£¼ìˆ íšŒì „</b>, <b>ë£¨í”¼</b>, <b>íƒ„ì§€ë¡œ</b>, <b>ì•„í¬ë¦´ìŠ¤íƒ ë“œ</b> ë“±
                    </div>

                    <div style="margin-top:10px; font-size:12px; color:rgba(15,23,42,.60); font-weight:900;">
                        <span th:if="${#lists.isEmpty(goodsList)}">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
                        <span th:if="${!#lists.isEmpty(goodsList)}">
                            ì´ <b th:text="${#lists.size(goodsList)}">0</b>ê°œì˜ ìƒí’ˆì´ ìˆìŠµë‹ˆë‹¤.
                        </span>
                    </div>

                    <div class="goods-table-wrap" th:if="${!#lists.isEmpty(goodsList)}">
                        <table class="goods-table">
                            <thead>
                            <tr>
                                <th>ì´ë¯¸ì§€</th>
                                <th>ì‘í’ˆëª…</th>
                                <th>ìºë¦­í„°</th>
                                <th>ìƒí’ˆëª…</th>
                                <th>ì¹´í…Œê³ ë¦¬</th>
                                <th>ê°€ê²©</th>
                                <th>ì¬ê³ </th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="g : ${goodsList}">
                                <td>
                                    <img th:if="${g.thumbnailUrl != null}"
                                         th:src="${g.thumbnailUrl}"
                                         alt="êµ¿ì¦ˆ ì¸ë„¤ì¼"
                                         class="goods-thumb">
                                    <span th:if="${g.thumbnailUrl == null}"
                                          style="font-size:11px;color:#9ca3af;font-weight:900;">
                                        ì´ë¯¸ì§€ ì—†ìŒ
                                    </span>
                                </td>
                                <td th:text="${g.workName}">-</td>
                                <td th:text="${g.characterName}">-</td>
                                <td th:text="${g.name}">-</td>
                                <td th:text="${g.category}">-</td>
                                <td th:text="${g.price != null ? g.price + 'ì›' : '-'}">-</td>
                                <td th:text="${g.stockQty != null ? g.stockQty + 'ê°œ' : '-'}">-</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="goods-empty" th:if="${#lists.isEmpty(goodsList)}">
                        ì´ ë§¤ì¥ì— ë“±ë¡ëœ êµ¿ì¦ˆê°€ ì—†ê±°ë‚˜, ê²€ìƒ‰ ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                </div>

                <!-- ì‚¬ì§„ ê·¸ë¦¬ë“œ(í˜„ì¬ goods ì¸ë„¤ì¼ ì¬í™œìš©) -->
                <div class="sd-photoTitle">ë§¤ì¥ ì‚¬ì§„</div>
                <div class="sd-photos">
                    <div class="sd-photo"
                         th:each="g, stat : ${goodsList}"
                         th:if="${goodsList != null and !#lists.isEmpty(goodsList) and g.thumbnailUrl != null and stat.index < 4}">
                        <img th:src="${g.thumbnailUrl}" alt="store photo"/>
                    </div>

                    <div class="goods-empty"
                         th:if="${goodsList == null or #lists.isEmpty(goodsList)}"
                         style="grid-column:1/-1;">
                        í‘œì‹œí•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                </div>

            </div>

            <!-- RIGHT -->
            <aside class="sd-right">
                <div class="sd-stockCard">
                    <div class="sd-stockHead">
                        <div style="opacity:.9;">â¬£</div>
                        <div class="sd-stockTitle">ì‹¤ì‹œê°„ ì¬ê³  í˜„í™©</div>
                    </div>

                    <div class="sd-stockBody">
                        <div class="sd-stockItem"
                             th:each="g, stat : ${goodsList}"
                             th:if="${goodsList != null and stat.index < 6}">
                            <div class="sd-stockTop">
                                <div class="sd-stockName" th:text="${g.name}">ìƒí’ˆëª…</div>
                                <div class="sd-stockCount" th:text="${g.stockQty != null ? g.stockQty + 'ê°œ' : '-'}">-</div>
                            </div>
                            <div class="sd-stockBar">
                                <!-- stockQty ê¸°ë°˜ bar (0~20ê°œë¥¼ 0~100%ë¡œ) -->
                                <span class="sd-stockFill"
                                      th:style="|width:${g.stockQty != null ? (g.stockQty > 20 ? 100 : g.stockQty * 5) : 0}%;|"></span>
                            </div>
                        </div>

                        <div class="sd-stockHint">* ì¬ê³ ëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>

                        <div class="goods-empty" th:if="${goodsList == null or #lists.isEmpty(goodsList)}">
                            ì¬ê³  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
            </aside>

        </section>

    </main>
</div>
</body>
</html>