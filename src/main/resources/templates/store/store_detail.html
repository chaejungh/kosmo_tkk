<!DOCTYPE html>
<html lang="ko"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{fragments/tkk_fragment/layout}">

<head>
    <th:block layout:fragment="head">
        <style>
            .sd-page{width:min(1200px,92%);margin:0 auto;padding:20px 0 60px}

            /* HERO */
            .sd-hero{height:420px;border-radius:18px;overflow:hidden;position:relative;
                border:1px solid #e5e7eb;box-shadow:0 14px 40px rgba(0,0,0,.12)}
            .sd-hero-bg{position:absolute;inset:0;background-size:cover;background-position:center}
            .sd-hero-fallback{position:absolute;inset:0;display:grid;place-items:center;
                background:#f3f4f6;font-weight:900;color:#64748b}

            /* GRID */
            .sd-grid{margin-top:24px;display:grid;grid-template-columns:1fr 360px;gap:24px}
            .sd-card{background:#fff;border:1px solid #e5e7eb;border-radius:18px;
                box-shadow:0 10px 26px rgba(0,0,0,.06);padding:20px;margin-bottom:18px}

            /* STORE INFO */
            .sd-titleRow{display:flex;justify-content:space-between;align-items:center}
            .sd-name{font-size:24px;font-weight:900}
            .sd-sub{font-size:13px;color:#475569;margin-top:4px}

            .like-btn{
                font-size:22px;background:none;border:none;cursor:pointer;
                transition:.2s;opacity:.4
            }
            .like-btn.active{opacity:1;color:#ff4d88;transform:scale(1.1)}

            .sd-infoRow{display:flex;gap:10px;margin-bottom:14px}
            .sd-label{font-size:12px;color:#64748b;font-weight:800}
            .sd-value{font-size:14px;font-weight:900;color:#0f172a}

            /* ACTION */
            .sd-actions{display:flex;gap:12px;margin-top:14px}
            .sd-btn{
                flex:1;padding:14px;border-radius:14px;
                font-weight:900;text-align:center
            }
            .sd-btn.pink{background:#ff4d88;color:#fff}
            .sd-btn.black{background:#111;color:#fff}

            /* GOODS */
            .goods-table{width:100%;border-collapse:collapse;font-size:13px}
            .goods-table th,.goods-table td{padding:10px;border-bottom:1px solid #e5e7eb}
            .goods-thumb{width:48px;height:48px;border-radius:10px;object-fit:cover}

            /* STOCK */
            .stock-item{margin-top:14px}
            .stock-bar{height:6px;background:#e5e7eb;border-radius:999px;overflow:hidden}
            .stock-bar span{display:block;height:100%;
                background:linear-gradient(90deg,#ff4d88,#ff9ec5)}
        </style>
    </th:block>
</head>

<body>
<div layout:fragment="content">
    <main class="sd-page">

        <!-- HERO -->
        <section class="sd-hero">
            <div class="sd-hero-bg"
                 th:if="${store.imageUrl != null}"
                 th:style="|background-image:url('${store.imageUrl}')|"></div>

            <div class="sd-hero-bg"
                 th:if="${store.imageUrl == null and !#lists.isEmpty(goodsList)}"
                 th:style="|background-image:url('${goodsList[0].thumbnailUrl}')|"></div>

            <div class="sd-hero-fallback"
                 th:if="${store.imageUrl == null and #lists.isEmpty(goodsList)}">
                ë§¤ì¥ ëŒ€í‘œ ì´ë¯¸ì§€
            </div>
        </section>

        <section class="sd-grid">

            <!-- LEFT -->
            <div>

                <!-- STORE -->
                <div class="sd-card">
                    <div class="sd-titleRow">
                        <div>
                            <h1 class="sd-name" th:text="${store.name}">ë§¤ì¥ëª…</h1>
                            <p class="sd-sub" th:text="${store.address}">ì£¼ì†Œ</p>
                        </div>

                        <!-- â¤ï¸ ì°œ -->
                        <button class="like-btn"
                                th:classappend="${liked} ? 'active' : ''"
                                th:data-store-id="${store.id}">
                            â¤ï¸
                        </button>
                    </div>
                </div>

                <!-- INFO -->
                <div class="sd-card">
                    <div class="sd-infoRow">
                        <div>ğŸ“</div>
                        <div>
                            <div class="sd-label">ì „í™”ë²ˆí˜¸</div>
                            <div class="sd-value" th:text="${store.tel}">-</div>
                        </div>
                    </div>

                    <div class="sd-infoRow">
                        <div>ğŸ•’</div>
                        <div>
                            <div class="sd-label">ì˜ì—…ì‹œê°„</div>
                            <div class="sd-value" th:text="${store.openTime}">-</div>
                        </div>
                    </div>

                    <!-- ACTION -->
                    <div class="sd-actions">
                        <a class="sd-btn pink"
                           th:href="@{/map/route(storeId=${store.id})}">
                            ğŸ§­ ê¸¸ì°¾ê¸°
                        </a>
                        <a class="sd-btn black"
                           th:href="'tel:' + ${store.tel}">
                            ğŸ“ ì „í™”í•˜ê¸°
                        </a>
                    </div>
                </div>

                <!-- GOODS -->
                <div class="sd-card">
                    <h3>êµ¿ì¦ˆ ì¬ê³ </h3>

                    <table class="goods-table" th:if="${!#lists.isEmpty(goodsList)}">
                        <thead>
                        <tr>
                            <th></th><th>ìƒí’ˆëª…</th><th>ê°€ê²©</th><th>ì¬ê³ </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="g : ${goodsList}">
                            <td><img class="goods-thumb" th:src="${g.thumbnailUrl}"></td>
                            <td th:text="${g.name}"></td>
                            <td th:text="${g.price}"></td>
                            <td th:text="${g.stockQty}"></td>
                        </tr>
                        </tbody>
                    </table>

                    <div th:if="${#lists.isEmpty(goodsList)}">êµ¿ì¦ˆ ì—†ìŒ</div>
                </div>

            </div>

            <!-- RIGHT -->
            <aside>
                <div class="sd-card">
                    <h3>ğŸ“¦ ì‹¤ì‹œê°„ ì¬ê³  í˜„í™©</h3>

                    <div class="stock-item"
                         th:each="g,stat : ${goodsList}"
                         th:if="${stat.index < 6}">
                        <b th:text="${g.name}"></b>
                        <div class="stock-bar">
                            <span th:style="'width:' + ${g.stockQty * 2} + '%'"></span>
                        </div>
                        <small th:text="${g.stockQty + 'ê°œ'}"></small>
                    </div>
                </div>
            </aside>

        </section>
    </main>

    <script>
        document.querySelectorAll('.like-btn').forEach(btn=>{
            btn.onclick=()=>{
                fetch(`/store/${btn.dataset.storeId}/like`,{method:'POST'})
                    .then(()=>btn.classList.toggle('active'))
            }
        })
    </script>

</div>
</body>
</html>