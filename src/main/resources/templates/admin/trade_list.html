<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/fragments/layout}">

<head>
    <th:block layout:fragment="head"></th:block>

    <style>
        /* ===== ì»¨í…Œì´ë„ˆ ===== */
        .market-wrap{
            max-width: 1100px;
            margin: 0 auto;
            padding: 22px 18px 80px;
        }
        .market-title{
            font-size: 26px;
            font-weight: 800;
            margin: 8px 0 2px;
        }
        .market-sub{
            font-size: 13px;
            color: var(--text-sub, #6b7280);
            margin-bottom: 16px;
        }

        /* ===== ìƒë‹¨ íƒ­ + ê²€ìƒ‰ë°” ===== */
        .market-top{
            background: #fff;
            border: 1px solid var(--border, #e5e7eb);
            border-radius: 16px;
            padding: 14px;
            display: flex;
            gap: 12px;
            align-items: center;
            box-shadow: 0 6px 18px rgba(0,0,0,0.04);
        }
        .market-tabs{
            display:flex;
            gap:8px;
            flex: none;
        }
        .tab-btn{
            border: 1px solid var(--border, #e5e7eb);
            background: #fff;
            border-radius: 12px;
            padding: 10px 14px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            display:flex;
            align-items:center;
            gap:8px;
            white-space: nowrap;
        }
        .tab-btn.active{
            border-color: rgba(236,72,153,.35);
            background: rgba(236,72,153,.10);
        }

        .market-search{
            flex: 1;
            display:flex;
            align-items:center;
            gap: 10px;
            background: #fff;
            border: 1px solid var(--border, #e5e7eb);
            border-radius: 999px;
            padding: 10px 12px;
            min-width: 280px;
        }
        .market-search .ico{opacity:.65}
        .market-search input{
            border: none;
            outline:none;
            width:100%;
            font-size: 13px;
            background: transparent;
        }
        .search-btn{
            border: none;
            border-radius: 999px;
            padding: 10px 16px;
            font-size: 13px;
            font-weight: 800;
            cursor: pointer;
            background: linear-gradient(135deg, #ff6aa2, #ff3d7a);
            color: #fff;
            white-space: nowrap;
        }

        .market-actions{
            position: relative;
            display:flex;
            gap: 8px;
            flex: none;
            align-items:center;
        }
        .icon-btn{
            width: 38px;
            height: 38px;
            border-radius: 12px;
            border: 1px solid var(--border, #e5e7eb);
            background: #fff;
            cursor:pointer;
            font-weight:900;
        }
        .icon-btn.active{
            border-color: rgba(17,24,39,.25);
            box-shadow: 0 6px 16px rgba(0,0,0,.06);
        }

        .sort-menu{
            position:absolute;
            right:0;
            top: 46px;
            width: 160px;
            background:#fff;
            border:1px solid var(--border, #e5e7eb);
            border-radius: 14px;
            box-shadow: 0 14px 30px rgba(0,0,0,0.10);
            overflow:hidden;
            display:none;
            z-index: 50;
        }
        .sort-menu a{
            display:block;
            padding: 10px 12px;
            font-size: 13px;
            color:#111827;
            text-decoration:none;
        }
        .sort-menu a:hover{ background:#f9fafb; }

        /* ===== ë¦¬ìŠ¤íŠ¸ ì˜ì—­ ===== */
        .trade-grid{
            margin-top: 16px;
            display:grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 16px;
        }

        /* grid ì¹´ë“œ */
        .trade-card{
            background:#fff;
            border:1px solid var(--border, #e5e7eb);
            border-radius: 18px;
            overflow:hidden;
            box-shadow: 0 10px 24px rgba(0,0,0,0.05);
            cursor:pointer;
            transition: transform .12s ease, box-shadow .12s ease;
        }
        .trade-card:hover{
            transform: translateY(-2px);
            box-shadow: 0 16px 34px rgba(0,0,0,0.08);
        }
        .thumb-wrap{
            position:relative;
            width:100%;
            aspect-ratio: 1 / 0.75;
            background: #0b1220;
        }
        .trade-thumb{
            width:100%;
            height:100%;
            object-fit: cover;
            display:block;
        }
        .heart-chip{
            position:absolute;
            right: 10px;
            top: 10px;
            width: 34px;
            height: 34px;
            border-radius: 999px;
            background: rgba(255,255,255,0.92);
            display:flex;
            align-items:center;
            justify-content:center;
            font-weight:900;
        }

        .trade-body{
            padding: 12px 12px 14px;
            display:flex;
            flex-direction: column;
            gap: 6px;
        }
        .trade-title{
            font-weight: 800;
            font-size: 13px;
            line-height: 1.25;
            display:-webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow:hidden;
        }
        .trade-meta{
            font-size: 12px;
            color: var(--text-sub, #6b7280);
        }
        .trade-bottom{
            margin-top: 6px;
            display:flex;
            align-items:center;
            justify-content: space-between;
            gap: 10px;
        }
        .trade-stats{
            font-size: 12px;
            color: #6b7280;
            white-space: nowrap;
        }
        .trade-price{
            font-weight: 900;
            font-size: 15px;
            white-space: nowrap;
        }

        /* ===== list-mode (ê°€ë¡œ ë¦¬ìŠ¤íŠ¸) ===== */
        .list-mode .trade-grid{
            grid-template-columns: 1fr;
        }
        .list-mode .trade-card{
            display:flex;
            align-items: stretch;
        }
        .list-mode .thumb-wrap{
            width: 220px;
            aspect-ratio: auto;
            height: 140px;
            flex: none;
        }
        .list-mode .trade-body{
            flex: 1;
            padding: 14px;
        }
        .list-mode .trade-title{-webkit-line-clamp: 2;}

        /* ===== ë°˜ì‘í˜• ===== */
        @media (max-width: 1100px){
            .trade-grid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
        }
        @media (max-width: 820px){
            .market-top{ flex-wrap: wrap; }
            .market-search{ flex: 1 1 100%; }
            .trade-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .list-mode .thumb-wrap{ width: 160px; height: 120px; }
        }
        @media (max-width: 520px){
            .trade-grid{ grid-template-columns: 1fr; }
        }

        /* ê¸€ì“°ê¸° ë²„íŠ¼ (ê¸°ì¡´ ìœ ì§€ ëŠë‚Œ) */
        .write-btn{
            position: fixed;
            right: 24px;
            bottom: 28px;
            background: linear-gradient(135deg, #ff6aa2, #ff3d7a);
            color:#fff;
            padding: 14px 18px;
            border-radius: 999px;
            font-weight: 900;
            text-decoration:none;
            box-shadow: 0 16px 30px rgba(255,61,122,0.25);
        }
    </style>
</head>

<body>
<div layout:fragment="content">
    <div class="market-wrap" id="marketRoot">

        <div class="market-title">ì¿ ì¿ ë§ˆì¼“</div>
        <div class="market-sub">ì• ë‹ˆ êµ¿ì¦ˆ ì¤‘ê³ ê±°ë˜ ì „ë¬¸ ë§ˆì¼“</div>

        <!-- ìƒë‹¨ (íƒ­ + ê²€ìƒ‰ + ë²„íŠ¼ë“¤) -->
        <div class="market-top">

            <div class="market-tabs">
                <button type="button" class="tab-btn active">
                    ğŸ§º ê±°ë˜ ìƒí’ˆ
                </button>
                <button type="button" class="tab-btn" onclick="location.href='/chat/list'">
                    ğŸ’¬ ì±„íŒ…
                    <span th:if="${unreadCount != null && unreadCount > 0}"
                          style="margin-left:6px; background:#ff3d7a; color:#fff; border-radius:999px; padding:2px 8px; font-size:11px;"
                          th:text="${unreadCount}">0</span>
                </button>
            </div>

            <form class="market-search" th:action="@{/trade/list.do}" method="get">
                <span class="ico">ğŸ”</span>
                <input type="text" name="keyword" placeholder="êµ¿ì¦ˆëª…, ì œëª©, ì§€ì—­ ê²€ìƒ‰" th:value="${keyword}">
                <button class="search-btn" type="submit">ê²€ìƒ‰</button>

                <!-- sort ìœ ì§€ -->
                <input type="hidden" name="sort" th:value="${sort}">
            </form>

            <div class="market-actions">
                <button class="icon-btn active" id="gridViewBtn" type="button" title="ê·¸ë¦¬ë“œ">â–¢</button>
                <button class="icon-btn" id="listViewBtn" type="button" title="ë¦¬ìŠ¤íŠ¸">â‰¡</button>
                <button class="icon-btn" id="sortBtn" type="button" title="ì •ë ¬">â‡…</button>

                <div id="sortMenu" class="sort-menu">
                    <a th:href="@{/trade/list.do(sort='like', keyword=${keyword})}">â¤ï¸ ì°œ ë§ì€ ìˆœ</a>
                    <a th:href="@{/trade/list.do(sort='view', keyword=${keyword})}">ğŸ‘€ ì¡°íšŒ ë§ì€ ìˆœ</a>
                    <a th:href="@{/trade/list.do(sort='latest', keyword=${keyword})}">ğŸ•’ ìµœì‹ ìˆœ</a>
                </div>
            </div>
        </div>

        <!-- ë¦¬ìŠ¤íŠ¸ -->
        <div class="trade-grid">
            <div class="trade-card"
                 th:each="post : ${page.content}"
                 th:onclick="|location.href='/trade/${post.id}/article/detail.do'|">

                <div class="thumb-wrap">
                    <img class="trade-thumb"
                         th:src="${post.thumbnailUrl != null ? post.thumbnailUrl : '/images/dummy/noimg.png'}"
                         alt="thumb">
                    <div class="heart-chip">â™¡</div>
                </div>

                <div class="trade-body">
                    <div class="trade-title" th:text="${post.title}">ì œëª©</div>
                    <div class="trade-meta">
                        <span th:text="${post.region}">ì§€ì—­</span>
                        Â·
                        <span th:text="${post.timeAgo}">ë°©ê¸ˆ ì „</span>
                    </div>

                    <div class="trade-bottom">
                        <div class="trade-stats">
                            â¤ï¸ <span th:text="${post.likeCount}">0</span>
                            Â· ğŸ’¬ <span th:text="${post.chatCount}">0</span>
                            Â· ğŸ‘€ <span th:text="${post.viewCount}">0</span>
                        </div>
                        <div class="trade-price" th:text="${post.priceText}">0ì›</div>
                    </div>
                </div>
            </div>
        </div>

        <a href="/trade/1/write" class="write-btn">+ ê¸€ì“°ê¸°</a>
    </div>
</div>

<script layout:fragment="script">
    const root = document.getElementById('marketRoot');
    const gridBtn = document.getElementById('gridViewBtn');
    const listBtn = document.getElementById('listViewBtn');

    // ê¸°ë³¸: ê·¸ë¦¬ë“œ
    gridBtn.addEventListener('click', () => {
        root.classList.remove('list-mode');
        gridBtn.classList.add('active');
        listBtn.classList.remove('active');
    });

    listBtn.addEventListener('click', () => {
        root.classList.add('list-mode');
        listBtn.classList.add('active');
        gridBtn.classList.remove('active');
    });

    // ì •ë ¬ ë©”ë‰´ í† ê¸€
    document.getElementById('sortBtn').addEventListener('click', () => {
        const menu = document.getElementById('sortMenu');
        menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
    });

    // ë°”ê¹¥ í´ë¦­í•˜ë©´ ì •ë ¬ ë‹«ê¸°
    document.addEventListener('click', (e) => {
        const menu = document.getElementById('sortMenu');
        const btn = document.getElementById('sortBtn');
        if (!menu.contains(e.target) && e.target !== btn) {
            menu.style.display = 'none';
        }
    });

    // (ë„ˆí¬ ê¸°ì¡´ WebSocket ìƒˆê¸€/ì±„íŒ…ë°© ë¦¬ë¡œë“œ ë¡œì§ì´ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„ ë¨)
</script>

</body>
</html>