<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë¬¸ì˜ ëª©ë¡ - ë”ì¿ ì¿ </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        :root{
            --bg:#F3F4F6;
            --card:#ffffff;
            --text:#111827;
            --sub:#6B7280;
            --muted:#9CA3AF;
            --border:#E5E7EB;

            --accent:#ff6b86;
            --accent-deep:#ff4d6d;

            --shadow:0 10px 26px rgba(0,0,0,0.06);
            --radius:18px;
        }
        *{box-sizing:border-box}
        body{
            margin:0;
            background:var(--bg);
            color:var(--text);
            font-family: "Noto Sans KR", system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", sans-serif;
        }

        .help-bg{ padding:18px 0 26px; }
        .page{
            width:min(980px, 92vw);
            margin:0 auto;
        }

        .card{
            background:var(--card);
            border:1px solid #EEF2F7;
            border-radius:var(--radius);
            box-shadow:var(--shadow);
            overflow:hidden;
        }

        /* ==== AI ìƒë‹´(ê·¸ëŒ€ë¡œ) ==== */
        .ai-box{
            padding:14px 16px;
            margin-bottom:12px;
        }
        .ai-header-main{
            font-size:15px;
            font-weight:1000;
            display:flex;
            align-items:center;
            gap:8px;
            margin-bottom:4px;
        }
        .ai-chip{
            font-size:11px;
            padding:2px 8px;
            border-radius:999px;
            background:rgba(255,107,134,.12);
            color:var(--accent-deep);
            font-weight:900;
        }
        .ai-subtext{
            font-size:12px;
            color:var(--sub);
            margin-bottom:10px;
            line-height:1.4;
        }
        .ai-input-row{
            display:flex;
            flex-direction:column;
            gap:10px;
        }
        .ai-textarea{
            width:100%;
            min-height:84px;
            padding:10px 12px;
            border-radius:14px;
            border:1px solid var(--border);
            resize:vertical;
            font-size:13px;
            font-family:inherit;
            background:#fff;
        }
        .ai-textarea:focus{
            outline:none;
            border-color:rgba(255,107,134,.55);
            box-shadow:0 0 0 3px rgba(255,107,134,.14);
        }
        .ai-btn-row{
            display:flex;
            justify-content:space-between;
            align-items:center;
            gap:10px;
            flex-wrap:wrap;
        }
        .ai-help-text{
            font-size:11px;
            color:var(--muted);
            font-weight:800;
        }
        .ai-send-btn{
            padding:9px 14px;
            border-radius:999px;
            border:none;
            background:var(--accent);
            color:#fff;
            font-size:13px;
            font-weight:900;
            cursor:pointer;
            white-space:nowrap;
            box-shadow:0 10px 18px rgba(255,107,134,.25);
        }
        .ai-send-btn:hover{ background:var(--accent-deep); }
        .ai-send-btn:disabled{ opacity:.6; cursor:default; }

        .ai-answer{
            margin-top:10px;
            padding:12px 12px;
            border-radius:14px;
            background:#ffffff;
            border:1px solid #EEF2F7;
            font-size:13px;
            line-height:1.55;
            white-space:pre-wrap;
        }
        .ai-answer-title{
            font-weight:1000;
            margin-bottom:6px;
            font-size:12px;
            color:#4B5563;
        }

        /* âœ… CTA(ë¬¸ì˜ ì‘ì„± ìœ ë„) ì¹´ë“œ */
        .cta{
            padding:14px 16px;
            margin-bottom:12px;
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px;
        }
        .cta-left{ display:flex; flex-direction:column; gap:3px; min-width:0; }
        .cta-title{
            font-size:14px;
            font-weight:1000;
            margin:0;
            letter-spacing:-.2px;
        }
        .cta-sub{
            font-size:12px;
            color:var(--sub);
            font-weight:800;
            line-height:1.35;
        }

        .write-btn{
            display:inline-flex;
            align-items:center;
            justify-content:center;
            gap:8px;
            padding:10px 14px;
            background:var(--accent);
            color:#fff;
            border-radius:999px;
            text-decoration:none;
            font-size:13px;
            font-weight:900;
            border:1px solid rgba(255,255,255,.0);
            box-shadow:0 10px 18px rgba(255,107,134,.25);
            white-space:nowrap;
            flex:none;
        }
        .write-btn:hover{ background:var(--accent-deep); }

        /* âœ… ëª©ë¡ ì„¹ì…˜ íƒ€ì´í‹€ */
        .section-head{
            display:flex;
            align-items:end;
            justify-content:space-between;
            margin: 6px 2px 10px;
        }
        .section-title{
            font-size:14px;
            font-weight:1000;
        }
        .section-sub{
            font-size:12px;
            color:var(--muted);
            font-weight:800;
        }

        .inq-card{
            padding:14px 14px;
            border-radius:var(--radius);
            background:var(--card);
            border:1px solid #EEF2F7;
            box-shadow:var(--shadow);
            margin-bottom:12px;
            cursor:pointer;
            transition:transform .08s ease, background .08s ease;
        }
        .inq-card:hover{
            background:#F9FAFB;
            transform:translateY(-1px);
        }
        .inq-title{
            font-size:14px;
            font-weight:1000;
            margin-bottom:6px;
            white-space:nowrap;
            overflow:hidden;
            text-overflow:ellipsis;
        }
        .inq-meta{
            display:flex;
            gap:10px;
            flex-wrap:wrap;
            font-size:12px;
            color:var(--sub);
            font-weight:800;
        }
        .inq-date{ color:var(--muted); }

        /* âœ… ë¹„ì—ˆì„ ë•Œ ë©”ì‹œì§€(ëª©ë¡ â€œì•ˆâ€ì´ ì•„ë‹ˆë¼ í˜ì´ì§€ íë¦„ìƒ ìì—°ìŠ¤ëŸ½ê²Œ) */
        .empty{
            padding:18px 16px;
            text-align:center;
            color:var(--sub);
            font-weight:900;
            border-radius:var(--radius);
            background:rgba(255,255,255,.65);
            border:1px solid rgba(238,242,247,.9);
            margin-bottom: 12px;
        }
        .empty small{
            display:block;
            margin-top:6px;
            font-weight:800;
            color:var(--muted);
        }

        @media (max-width: 640px){
            .page{ width:min(680px, 94vw); }
            .write-btn{ padding:9px 12px; font-size:12px; }
        }
    </style>
</head>

<body>
<div class="help-bg">
    <div class="page">

        <!-- ğŸ”¹ AI ìƒë‹´ ì˜ì—­ (ê¸°ëŠ¥ ê·¸ëŒ€ë¡œ) -->
        <div class="card ai-box">
            <div class="ai-header-main">
                AI ë¹ ë¥¸ ìƒë‹´ <span class="ai-chip">ë² íƒ€</span>
            </div>
            <div class="ai-subtext">
                ê°„ë‹¨í•œ ì´ìš©ë¬¸ì˜ëŠ” AIì—ê²Œ ë¨¼ì € ë¬¼ì–´ë³´ì„¸ìš”. ì›í•˜ëŠ” ë‹µì´ ì—†ìœ¼ë©´ ì•„ë˜ì—ì„œ ì§ì ‘ ë¬¸ì˜ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆì–´ìš”.
            </div>

            <div class="ai-input-row">
                <textarea id="aiQuestion"
                          class="ai-textarea"
                          placeholder="ì˜ˆ) êµ¿ì¦ˆ ê±°ë˜ëŠ” ì–´ë–»ê²Œ ì§„í–‰ë˜ë‚˜ìš”? / ë§¤ì¥ ë¶ë§ˆí¬ëŠ” ì–´ë””ì„œ ë³¼ ìˆ˜ ìˆë‚˜ìš”?"></textarea>

                <div class="ai-btn-row">
                    <div class="ai-help-text">AI ë‹µë³€ì€ ì‹¤ì œ ìš´ì˜ì ë‹µë³€ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆì–´ìš”.</div>
                    <button type="button"
                            class="ai-send-btn"
                            id="aiSendBtn"
                            onclick="sendAiInquiry()">
                        AIì—ê²Œ ë¬¼ì–´ë³´ê¸°
                    </button>
                </div>
            </div>

            <div id="aiAnswerBox" class="ai-answer" style="display:none;">
                <div class="ai-answer-title">AI ë‹µë³€</div>
                <div id="aiAnswerText"></div>
            </div>
        </div>

        <!-- âœ… ë¬¸ì˜ ì‘ì„± CTA (ë²„íŠ¼ì„ AI ë°”ë¡œ ì•„ë˜ë¡œ) -->
        <div class="card cta">
            <div class="cta-left">
                <p class="cta-title">ì›í•˜ëŠ” ë‹µì´ ì—†ë‚˜ìš”?</p>
                <div class="cta-sub">ì§ì ‘ ë¬¸ì˜ë¥¼ ë‚¨ê¸°ë©´ ìš´ì˜ìê°€ í™•ì¸ í›„ ë‹µë³€í•´ë“œë ¤ìš”.</div>
            </div>
            <!-- ë§í¬ ê·¸ëŒ€ë¡œ -->
            <a href="/help/write.do" class="write-btn">+ ë¬¸ì˜ ì‘ì„±</a>
        </div>

        <!-- âœ… ë¬¸ì˜ê°€ ì—†ìœ¼ë©´: ëª©ë¡ ì„¹ì…˜ ìì²´ë¥¼ ìˆ¨ê¸°ê³  ì•ˆë‚´ë§Œ -->
        <div th:if="${inquiryList == null or #lists.isEmpty(inquiryList)}" class="empty">
            ì•„ì§ ë¬¸ì˜ê°€ ì—†ì–´ìš” ğŸ™‚
            <small>ìœ„ ë²„íŠ¼ìœ¼ë¡œ ì²« ë¬¸ì˜ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”.</small>
        </div>

        <!-- âœ… ë¬¸ì˜ê°€ ìˆì„ ë•Œë§Œ: ëª©ë¡ íƒ€ì´í‹€ + ëª©ë¡ ì¶œë ¥ -->
        <div th:if="${inquiryList != null and !#lists.isEmpty(inquiryList)}">
            <div class="section-head">
                <div class="section-title">ë‚´ ë¬¸ì˜ ëª©ë¡</div>
                <div class="section-sub">ì‘ì„±í•œ ë¬¸ì˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”</div>
            </div>

            <div th:each="inq : ${inquiryList}"
                 class="inq-card"
                 th:onclick="'location.href=\'/help/' + ${inq.id} + '/detail.do\''">

                <div class="inq-title" th:text="${inq.title}">ë¬¸ì˜ ì œëª©</div>

                <div class="inq-meta">
                    <span class="inq-category" th:text="'ì¹´í…Œê³ ë¦¬: ' + ${inq.category}">ì¹´í…Œê³ ë¦¬</span>
                    <span class="inq-date" th:text="'ì‘ì„±ì¼: ' + ${inq.createdAt}">ì‘ì„±ì¼</span>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- ğŸ”¹ AI ìƒë‹´ JS (ê¸°ëŠ¥ ê·¸ëŒ€ë¡œ) -->
<script>
    async function sendAiInquiry() {
        const textarea = document.getElementById('aiQuestion');
        const btn = document.getElementById('aiSendBtn');
        const answerBox = document.getElementById('aiAnswerBox');
        const answerText = document.getElementById('aiAnswerText');

        const question = textarea.value.trim();
        if (!question) {
            alert('AIì—ê²Œ ë¬¼ì–´ë³¼ ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
            textarea.focus();
            return;
        }

        btn.disabled = true;
        answerBox.style.display = 'block';
        answerText.textContent = 'ë‹µë³€ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...';

        try {
            const res = await fetch('/api/help/ai', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ question: question })
            });

            if (!res.ok) throw new Error('response not ok');

            const data = await res.json();
            answerText.textContent = data.answer || 'ë‹µë³€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
        } catch (e) {
            console.error(e);
            answerText.textContent = 'ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
        } finally {
            btn.disabled = false;
        }
    }
</script>

</body>
</html>