<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>채팅방 목록</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #f5f5f5;
            font-family: 'Apple SD Gothic Neo', sans-serif;
        }

        .header {
            position: sticky;
            top: 0;
            background: white;
            padding: 16px;
            font-size: 20px;
            font-weight: 700;
            border-bottom: 1px solid #ddd;
        }

        .chat-list {
            margin-top: 0;
        }

        .room-item {
            display: flex;
            align-items: center;
            padding: 14px;
            background: white;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }

        .room-item:hover {
            background: #fafafa;
        }

        .thumb {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            margin-right: 12px;
            background: #ddd;
        }

        .room-info {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .room-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .room-lastmsg {
            font-size: 13px;
            color: #666;
            margin-bottom: 2px;
        }

        .room-price {
            font-size: 14px;
            font-weight: 600;
            margin-top: 4px;
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 11px;
            margin-left: 4px;
            color: white;
        }

        .badge-onsale {
            background: #5c7cfa;
        }

        .badge-reserved {
            background: #f59f00;
        }

        .badge-sold {
            background: #e03131;
        }

        .time {
            font-size: 12px;
            color: #999;
            margin-left: 8px;
        }

    </style>
</head>
<body>

<div class="header">채팅</div>

<div class="chat-list">

    <!-- 반복: 내가 속한 채팅방들 -->
    <div class="room-item"
         th:each="room : ${rooms}"
         th:onclick="|location.href='/trade/${memberId}/chat/${room.id}'|">

        <!-- 상품 이미지 -->
        <img class="thumb"
             th:src="${room.trade.thumbnailUrl != null} ? ${room.trade.thumbnailUrl} : '/images/dummy/noimg.png'"/>

        <div class="room-info">

            <!-- 판매자 닉네임 + 상태 + 시간 -->
            <div class="room-title">
                <span th:text="${room.trade.seller.nickname}"></span>

                <span class="badge"
                      th:classappend="${room.trade.status == 'RESERVED'} ? 'badge-reserved' :
                                      (${room.trade.status == 'SOLD' || room.trade.status == 'SOLD_OUT'} ? 'badge-sold' : 'badge-onsale')">
                    <span th:text="( (${room.trade.status} == 'RESERVED') ? '예약중' :
                                   (${room.trade.status} == 'SOLD' || ${room.trade.status} == 'SOLD_OUT' ? '완료' : '판매중') )"></span>
                </span>

                <span class="time"
                      th:text="${room.lastMessageAt}"></span>
            </div>

            <!-- 마지막 메시지 -->
            <div class="room-lastmsg"
                 th:text="${room.tradeChatMessages.size() > 0 ?
                            room.tradeChatMessages.iterator().next().message :
                            '메시지가 없습니다.'}">
            </div>

            <!-- 가격 -->
            <div class="room-price"
                 th:text="${room.trade.price != null ?
                           #numbers.formatInteger(room.trade.price, 3, 'COMMA') + '원' :
                           '가격 미정'}"></div>
        </div>

    </div> <!-- room-item end -->

</div> <!-- chat-list -->

</body>
</html>