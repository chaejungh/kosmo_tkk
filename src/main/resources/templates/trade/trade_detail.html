<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/fragments/layout}">
<head>
    <title th:text="${trade.title} + ' | ÍµøÏ¶àÍ±∞Îûò | ÎçîÏø†Ïø†'">ÍµøÏ¶àÍ±∞Îûò ÏÉÅÏÑ∏ | ÎçîÏø†Ïø†</title>

    <!-- ‚úÖ Î∑∞/ÌÅ¨Í∏∞Îßå ÎßûÏ∂§ (Í∏∞Îä•/ÎßÅÌÅ¨/Ìèº/Ï°∞Í±¥Î¨∏ Í∑∏ÎåÄÎ°ú) -->
    <th:block layout:fragment="head">
        <style>
            /* Î∞∞Í≤Ω/Ìè≠: ÎßàÏù¥ÌéòÏù¥ÏßÄ Î©îÏù∏ ÎäêÎÇå */
            .trade-bg{
                background:#f3f4f6;
                padding: 22px 0 64px;
                min-height: calc(100vh - 120px);
            }
            .trade-container{
                width: min(1100px, 92vw);
                margin: 0 auto;
            }

            /* ÏÉÅÎã® Î∞î ÏÇ¥Ïßù Ï†ïÎ¶¨ */
            .top-bar{
                position: sticky;
                top: 0;
                z-index: 50;
                background: rgba(243,244,246,0.92);
                backdrop-filter: blur(8px);
                border-bottom: 1px solid #e5e7eb;
            }
            .top-bar-inner{
                width: min(1100px, 92vw);
                margin: 0 auto;
                display:flex;
                align-items:center;
                gap: 10px;
                padding: 12px 6px;
            }
            .back-btn{
                text-decoration:none;
                display:inline-flex;
                align-items:center;
                justify-content:center;
                width: 36px;
                height: 36px;
                border-radius: 999px;
                border: 1px solid #e5e7eb;
                background:#fff;
                font-weight:900;
                color:#111827;
            }
            .top-title{
                font-weight: 900;
                font-size: 16px;
                color:#111827;
            }

            /* Ï§ëÏïô Ï†ïÎ†¨ + Ïó¨Î∞± */
            .detail-page{
                padding: 18px 0 0;
            }

            /* Î†àÏù¥ÏïÑÏõÉ: Ï¢å(Ïù¥ÎØ∏ÏßÄ) Ïö∞(Ï†ïÎ≥¥) Ïπ¥Îìú */
            .detail-layout{
                width: 100%;
                display: grid;
                grid-template-columns: minmax(0, 1fr) minmax(0, 1.05fr);
                gap: 16px;
                align-items: start;
            }

            /* Ïπ¥Îìú Í≥µÌÜµ */
            .image-box, .info-card{
                background:#fff;
                border: 1px solid #eef2f7;
                border-radius: 18px;
                box-shadow: 0 10px 26px rgba(0,0,0,0.06);
                overflow:hidden;
            }

            /* Ïù¥ÎØ∏ÏßÄ ÏòÅÏó≠ */
            .image-box{ padding: 14px; }
            .image-frame{
                border-radius: 16px;
                overflow:hidden;
                background:#f3f4f6;
                border: 1px solid #eef2f7;
                aspect-ratio: 1 / 1; /* Ï†ïÏÇ¨Í∞Å ÏïàÏ†ï */
                display:flex;
                align-items:center;
                justify-content:center;
            }
            .image-frame img{
                width: 100%;
                height: 100%;
                object-fit: cover;
                display:block;
            }

            /* Ï†ïÎ≥¥ Ïπ¥Îìú */
            .info-card{ padding: 16px; }

            /* ÌåêÎß§Ïûê Ïπ¥Îìú */
            .seller-card{
                display:flex;
                align-items:center;
                gap: 12px;
                padding: 12px;
                border: 1px solid #eef2f7;
                border-radius: 16px;
                background:#fff;
            }
            .seller-avatar{
                width: 44px;
                height: 44px;
                border-radius: 999px;
                background:#f3f4f6;
                display:flex;
                align-items:center;
                justify-content:center;
                border: 1px solid #e5e7eb;
                flex: none;
                font-size: 18px;
            }
            .seller-info-main{ min-width:0; flex:1; }
            .seller-name a{
                font-weight: 900;
                color:#111827;
                text-decoration:none;
            }
            .seller-name a:hover{ text-decoration:underline; }
            .seller-region{
                margin-top: 2px;
                font-size: 13px;
                font-weight: 800;
                color:#6b7280;
                overflow:hidden;
                text-overflow:ellipsis;
                white-space:nowrap;
            }
            .detail-header-actions{
                display:flex;
                gap: 8px;
                flex: none;
            }
            .detail-action-btn{
                text-decoration:none;
                font-weight: 900;
                font-size: 13px;
                padding: 8px 10px;
                border-radius: 999px;
                border: 1px solid #e5e7eb;
                background:#fff;
                color:#111827;
            }
            .detail-action-delete{
                border-color:#fecaca;
                color:#b91c1c;
                background:#fff5f5;
            }

            /* Ï†úÎ™©/Î©îÌÉÄ */
            .title{
                margin: 14px 2px 6px;
                font-size: 20px;
                font-weight: 1000;
                letter-spacing: -0.2px;
                line-height: 1.25;
            }
            .meta{
                color:#6b7280;
                font-weight: 800;
                font-size: 13px;
                margin-bottom: 10px;
            }

            /* Ï¢ãÏïÑÏöî/Ï°∞Ìöå */
            .stats-row{
                display:flex;
                align-items:center;
                gap: 10px;
                flex-wrap: wrap;
                padding: 10px 12px;
                border-radius: 14px;
                background:#f8fafc;
                border: 1px solid #eef2f7;
                margin-bottom: 12px;
                font-weight: 800;
                color:#111827;
            }
            .like-form{ margin:0; }
            .like-btn{
                width: 38px;
                height: 38px;
                border-radius: 999px;
                border: 1px solid #e5e7eb;
                background:#fff;
                font-size: 18px;
                font-weight: 900;
                cursor:pointer;
                display:flex;
                align-items:center;
                justify-content:center;
                line-height: 1;
            }
            .like-btn.liked{
                border-color:#fecaca;
                background:#fff1f2;
                color:#e11d48;
            }

            /* Í∞ÄÍ≤© */
            .price{
                font-size: 22px;
                font-weight: 1000;
                margin: 4px 2px 12px;
            }

            /* ÏÉÅÌÉú/ÎùºÎ≤® */
            .status-row{
                display:flex;
                align-items:flex-start;
                justify-content: space-between;
                gap: 10px;
                margin-bottom: 12px;
            }
            .status-badge{
                display:inline-flex;
                align-items:center;
                padding: 7px 10px;
                border-radius: 999px;
                font-weight: 900;
                font-size: 12px;
                border: 1px solid #e5e7eb;
                background:#f3f4f6;
                color:#111827;
                flex: none;
            }
            .label-row{
                display:flex;
                gap: 8px;
                flex-wrap: wrap;
                justify-content: flex-end;
            }
            .label-chip{
                display:inline-flex;
                align-items:center;
                padding: 7px 10px;
                border-radius: 999px;
                font-weight: 900;
                font-size: 12px;
                background:#fff;
                border: 1px solid #e5e7eb;
                color:#111827;
                white-space:nowrap;
            }

            /* Î≥∏Î¨∏ */
            .desc-box{
                white-space: pre-wrap;
                background:#fff;
                border: 1px solid #eef2f7;
                border-radius: 16px;
                padding: 12px 12px;
                color:#111827;
                font-weight: 700;
                line-height: 1.6;
                min-height: 120px;
                margin-bottom: 14px;
            }

            /* Î≤ÑÌäº */
            .button-wrap{
                display:flex;
                gap: 10px;
                align-items:center;
            }
            .btn-main{
                width: 100%;
                border: none;
                background:#111827;
                color:#fff;
                font-weight: 1000;
                border-radius: 14px;
                padding: 12px 14px;
                cursor:pointer;
            }
            .btn-main:hover{ opacity: .95; }

            /* Î∞òÏùëÌòï */
            @media (max-width: 980px){
                .detail-layout{
                    grid-template-columns: 1fr;
                }
                .image-frame{ aspect-ratio: 16/11; }
            }
        </style>
    </th:block>
</head>
<body>

<div layout:fragment="content">

    <header class="top-bar">
        <div class="top-bar-inner">
            <a class="back-btn" type="button" th:href="@{/trade/list.do}">‚Üê</a>
            <div class="top-title">ÍµøÏ¶àÍ±∞Îûò</div>
        </div>
    </header>

    <!-- ‚úÖ Î∞∞Í≤Ω/Ìè≠ ÎûòÌçº(Î∑∞Îßå) -->
    <div class="trade-bg">
        <div class="trade-container">

            <main class="detail-page"
                  style="display: flex;
                         min-height: 76vh;
                         justify-content: center;
                         align-items: center;">

                <section class="detail-layout">

                    <!-- üî• ÎåÄÌëú Ïù¥ÎØ∏ÏßÄ -->
                    <div class="image-box">
                        <div class="image-frame">
                            <img th:src="${coverUrl}"
                                 th:onclick="'location.href=\'/trade/' + ${trade.id} + '/article/' + ${coverImageId} + '/detail.do\''"
                                 style="cursor:pointer;"
                                 alt="ÍµøÏ¶à Ïù¥ÎØ∏ÏßÄ"/>
                        </div>
                    </div>

                    <!-- Ïò§Î•∏Ï™Ω Ï†ïÎ≥¥ -->
                    <div class="info-card">

                        <!-- üîº ÌîÑÎ°úÌïÑ Ïπ¥Îìú (ÎãâÎÑ§ÏûÑ ÌÅ¥Î¶≠ ‚Üí ÌåêÎß§Ïûê Î¶¨Ïä§Ìä∏Î°ú Ïù¥Îèô) -->
                        <div class="seller-card">
                            <div class="seller-avatar"><span>üë§</span></div>

                            <div class="seller-info-main">
                                <div class="seller-name">
                                    <a th:href="@{|/trade/seller/${sellerId}|}"
                                       th:text="${trade.seller != null ? trade.seller.nickname : 'ÌåêÎß§Ïûê #' + trade.sellerId}">
                                        ÌåêÎß§Ïûê
                                    </a>
                                </div>

                                <div class="seller-region"
                                     th:text="${trade.region != null ? trade.region : 'ÏßÄÏó≠ ÎØ∏Îì±Î°ù'}"></div>
                            </div>

                            <div class="detail-header-actions"
                                 th:if="${currentMemberId != null and currentMemberId == trade.sellerId}">
                                <a class="detail-action-btn"
                                   th:href="@{'/trade/' + ${currentMemberId} + '/article/' + ${trade.id} + '/edit.do'}">
                                    ÏàòÏ†ï
                                </a>
                                <a class="detail-action-btn detail-action-delete"
                                   th:href="@{'/trade/' + ${currentMemberId} + '/article/' + ${trade.id} + '/delete.do'}"
                                   onclick="return confirm('Í≤åÏãúÎ¨ºÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?');">
                                    ÏÇ≠Ï†ú
                                </a>
                            </div>
                        </div>

                        <!-- Í∏Ä Ï†úÎ™© -->
                        <h1 class="title" th:text="${trade.title}"></h1>

                        <!-- Îì±Î°ùÏùº -->
                        <div class="meta">
                            <span th:text="${#temporals.format(trade.createdAt, 'MM/dd')} + ' Îì±Î°ù'"></span>
                        </div>

                        <!-- üîπ Ï¢ãÏïÑÏöî / Ï±ÑÌåÖ / Ï°∞ÌöåÏàò + ÌÜ†Í∏Ä ÌïòÌä∏ -->
                        <div class="stats-row">

                            <!-- Îπà ÌïòÌä∏ (ÏïÑÏßÅ Ï∞ú ÏïàÌï®) -->
                            <form class="like-form"
                                  th:if="${!liked}"
                                  th:action="@{|/trade/${currentMemberId}/BookMark|}"
                                  method="post">
                                <input type="hidden" name="tradeId" th:value="${trade.id}">
                                <button type="submit" class="like-btn">‚ô°</button>
                            </form>

                            <!-- Îπ®Í∞Ñ ÌïòÌä∏ (Ïù¥ÎØ∏ Ï∞úÌïú ÏÉÅÌÉú) -->
                            <form class="like-form"
                                  th:if="${liked}"
                                  th:action="@{|/trade/${currentMemberId}/BookMarkDelete|}"
                                  method="post">
                                <input type="hidden" name="tradeId" th:value="${trade.id}">
                                <button type="submit" class="like-btn liked">‚ô•</button>
                            </form>

                            <span>
                                <span th:text="${likeCount}">0</span> Ï∞ú ¬∑
                                üí¨ <span th:text="${chatCount}">0</span> Ï±ÑÌåÖ ¬∑
                                Ï°∞Ìöå <span th:text="${trade.viewCount != null ? trade.viewCount : 0}">0</span>
                            </span>
                        </div>

                        <!-- Í∞ÄÍ≤© -->
                        <div class="price"
                             th:text="${#numbers.formatInteger(trade.price, 0, 'COMMA')} + 'Ïõê'"></div>

                        <div class="status-row">
                            <span class="status-badge"
                                  th:classappend="${statusClass}"
                                  th:text="${statusLabel}"></span>

                            <div class="label-row">
                                <span class="label-chip" th:text="${trade.category}"></span>
                                <span class="label-chip" th:text="${trade.tradeType}"></span>
                                <span class="label-chip" th:text="${trade.tradeMethod}"></span>
                            </div>
                        </div>

                        <div class="desc-box" th:text="${trade.content}"></div>

                        <!-- Ï±ÑÌåÖÌïòÍ∏∞ Î≤ÑÌäº -->
                        <div class="button-wrap">
                            <form
                                    th:if="${trade.sellerId != currentMemberId}"
                                    th:action="@{|/trade/${trade.id}/chat/start|}"
                                    method="post" style="flex:1;">
                                <button type="submit" class="btn-main">Ï±ÑÌåÖÌïòÍ∏∞</button>
                            </form>
                        </div>

                    </div>
                </section>

            </main>

        </div>
    </div>

</div>
</body>
</html>