<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>êµ¿ì¦ˆê±°ë˜ ê¸€ì“°ê¸° | ë”ì¿ ì¿ </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        :root {
            --purple: #6366f1;
            --purple-deep: #4f46e5;
            --border: #e5e7eb;
            --bg: #fafafa;
            --text-main: #111827;
            --text-sub: #6b7280;
        }

        body {
            margin: 0;
            background: var(--bg);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .write-wrap {
            max-width: 680px;
            margin: 0 auto;
            padding: 16px;
        }

        .title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 14px;
        }

        .img-upload-box {
            background: #ffffff;
            border: 1px dashed var(--border);
            border-radius: 12px;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .img-upload-box:hover {
            border-color: var(--purple);
        }

        .img-preview-wrap {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .preview-item {
            position: relative;
        }

        .preview-img {
            width: 110px;
            height: 110px;
            object-fit: cover;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .remove-btn {
            position: absolute;
            top: -6px;
            right: -6px;
            background: rgba(0,0,0,0.7);
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 13px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .input-box {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-top: 18px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }

        .input-label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-main);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
            outline: none;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .submit-btn {
            margin-top: 24px;
            width: 100%;
            padding: 16px;
            background: var(--purple);
            color: white;
            border: none;
            font-size: 16px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
        }

        .submit-btn:hover {
            background: var(--purple-deep);
        }
    </style>
</head>

<body>

<div class="write-wrap">

    <h1 class="title">êµ¿ì¦ˆê±°ë˜ ê¸€ì“°ê¸°</h1>

    <!-- TradePost ê°ì²´ ë°”ì¸ë”© -->
    <form th:action="${mode} == 'edit' ?
        @{/trade/{memberId}/article/{postId}/edit.do(memberId=${memberId}, postId=${postId})} :
        @{/trade/{memberId}/write(memberId=${memberId})}"
          th:object="${tradeWriteValid}"
          method="post"
          enctype="multipart/form-data">

        <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
        <div class="img-upload-box" onclick="document.getElementById('imgInput').click()">
            ğŸ“· í´ë¦­í•´ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œ (ì—¬ëŸ¬ ì¥ ê°€ëŠ¥)
        </div>

        <input type="file"
               id="imgInput"
               name="images"
               accept="image/*"
               multiple
               style="display:none">
        <div class="img-preview-wrap" id="previewArea"></div>

        <!-- ì œëª© -->
        <div class="input-box">
            <div class="input-label">ì œëª© *</div>
            <input type="text" th:field="*{title}" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
        </div>

        <!-- ê°€ê²© -->
        <div class="input-box">
            <div class="input-label">ê°€ê²©</div>
            <input type="number" th:field="*{price}" placeholder="ì˜ˆ: 15000" required>
        </div>

        <!-- ì¹´í…Œê³ ë¦¬ -->
        <div class="input-box">
            <div class="input-label">ì¹´í…Œê³ ë¦¬</div>
            <select th:field="*{category}" required>
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="í¬ì¹´">í¬ì¹´</option>
                <option value="í”¼ê·œì–´">í”¼ê·œì–´</option>
                <option value="ê¸°íƒ€êµ¿ì¦ˆ">ê¸°íƒ€êµ¿ì¦ˆ</option>
            </select>
        </div>

        <!-- ì§€ì—­ -->
        <div class="input-box">
            <div class="input-label">ì§€ì—­</div>
            <input type="text" th:field="*{region}" placeholder="ì˜ˆ: í™ëŒ€ / ì‹ ì´Œ / ê°•ë‚¨">
        </div>

        <!-- ê±°ë˜ ë°©ì‹ -->
        <div class="input-box">
            <div class="input-label">ê±°ë˜ ë°©ì‹</div>
            <select th:field="*{tradeMethod}">
                <option value="DIRECT">ì§ê±°ë˜</option>
                <option value="DELIVERY">íƒë°°ê±°ë˜</option>
                <option value="BOTH">ì§ê±°ë˜ + íƒë°°</option>
            </select>
        </div>
        <!-- ê±°ë˜ ìƒíƒœ -->
        <div class="input-box">
            <div class="input-label">ê±°ë˜ ìƒíƒœ</div>
            <select th:field="*{status}">
                <option value="ON_SALE">íŒë§¤ì¤‘</option>
                <option value="RESERVED">ì˜ˆì•½</option>
                <option value="DONE">íŒë§¤ì™„ë£Œ</option>
            </select>
        </div>

        <!-- ìƒì„¸ ë‚´ìš© -->
        <div class="input-box">
            <div class="input-label">ì„¤ëª… *</div>
            <textarea th:field="*{content}"
                      placeholder="ìƒí’ˆ ìƒíƒœ, ê±°ë˜ í¬ë§ ì‹œê°„ ë“±ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                      required></textarea>
        </div>

        <button class="submit-btn" type="submit">ë“±ë¡í•˜ê¸°</button>
    </form>

</div>

<script>
    const imgInput = document.getElementById("imgInput");
    const previewArea = document.getElementById("previewArea");

    let selectedFiles = [];

    imgInput.addEventListener("change", (e) => {
        const files = Array.from(e.target.files);
        selectedFiles = files;
        renderPreview();
    });

    function renderPreview() {
        previewArea.innerHTML = "";

        selectedFiles.forEach((file, idx) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const div = document.createElement("div");
                div.className = "preview-item";
                div.innerHTML = `
                    <img src="${e.target.result}" class="preview-img">
                    <div class="remove-btn" onclick="removeImg(${idx})">Ã—</div>
                `;
                previewArea.appendChild(div);
            };
            reader.readAsDataURL(file);
        });
    }

    function removeImg(index) {
        selectedFiles.splice(index, 1);

        const dt = new DataTransfer();
        selectedFiles.forEach(f => dt.items.add(f));
        imgInput.files = dt.files;

        renderPreview();
    }
</script>

</body>
</html>