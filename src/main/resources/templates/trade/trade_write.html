<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/fragments/layout}">

<head>
    <th:block layout:fragment="head">
        <style>
            :root{
                --bg:#f4f5f7;
                --card:#ffffff;
                --text:#111827;
                --sub:#6b7280;
                --border:#e5e7eb;

                --accent:#ff6b86;
                --accentDeep:#ff4d6d;
                --purple:#6366f1;
                --purpleDeep:#4f46e5;

                --shadow: 0 10px 30px rgba(17,24,39,.08);
                --radius: 18px;
            }

            .trade-write-wrap{
                max-width: 920px;
                margin: 0 auto;
                padding: 12px 16px 90px;
            }

            /* ìƒë‹¨ í—¤ë” */
            .tw-head{
                background: linear-gradient(135deg, rgba(255,107,134,.16), rgba(99,102,241,.14));
                border: 1px solid rgba(229,231,235,.9);
                border-radius: 22px;
                box-shadow: var(--shadow);
                padding: 18px 18px 16px;
                margin: 6px 0 14px;
                position: relative;
                overflow: hidden;
            }
            .tw-head:before{
                content:"";
                position:absolute;
                right:-60px; top:-60px;
                width:180px; height:180px;
                background: radial-gradient(circle at 30% 30%, rgba(255,107,134,.35), rgba(99,102,241,.0) 70%);
                filter: blur(0px);
            }
            .tw-title{
                margin:0;
                font-size: 20px;
                font-weight: 900;
                color: var(--text);
                letter-spacing: -.2px;
            }
            .tw-sub{
                margin:6px 0 0;
                font-size: 13px;
                color: var(--sub);
            }
            .tw-badges{
                margin-top: 10px;
                display:flex;
                gap:8px;
                flex-wrap: wrap;
            }
            .tw-pill{
                font-size: 12px;
                padding: 6px 10px;
                border-radius: 999px;
                background:#fff;
                border:1px solid var(--border);
                color: var(--text);
                display:inline-flex;
                align-items:center;
                gap:6px;
            }
            .tw-pill.pink{
                background: rgba(255,107,134,.14);
                border-color: rgba(255,107,134,.25);
            }
            .tw-pill.purple{
                background: rgba(99,102,241,.14);
                border-color: rgba(99,102,241,.25);
            }

            /* í¼ ì¹´ë“œ */
            .tw-card{
                background: var(--card);
                border: 1px solid var(--border);
                border-radius: 22px;
                box-shadow: var(--shadow);
                overflow: hidden;
            }
            .tw-card-inner{
                padding: 16px;
            }

            /* ì—…ë¡œë” */
            .uploader{
                border: 1.5px dashed rgba(17,24,39,.18);
                border-radius: 18px;
                padding: 16px;
                background: linear-gradient(180deg, rgba(255,255,255,1), rgba(244,245,247,.7));
                cursor: pointer;
                transition: .15s ease;
                position: relative;
            }
            .uploader:hover{
                border-color: rgba(255,107,134,.55);
                box-shadow: 0 10px 22px rgba(255,107,134,.10);
            }
            .uploader.dragover{
                border-color: rgba(99,102,241,.7);
                box-shadow: 0 10px 22px rgba(99,102,241,.12);
                background: linear-gradient(180deg, rgba(255,255,255,1), rgba(99,102,241,.08));
            }
            .uploader-row{
                display:flex;
                gap:14px;
                align-items:center;
            }
            .uploader-ico{
                width: 46px;
                height: 46px;
                border-radius: 16px;
                display:flex;
                align-items:center;
                justify-content:center;
                background: rgba(255,107,134,.16);
                border: 1px solid rgba(255,107,134,.18);
                font-size: 20px;
                flex: 0 0 auto;
            }
            .uploader-title{
                font-weight: 900;
                color: var(--text);
                margin:0;
                font-size: 14px;
            }
            .uploader-desc{
                margin:4px 0 0;
                color: var(--sub);
                font-size: 12px;
            }
            .uploader-actions{
                margin-left:auto;
                display:flex;
                gap:8px;
                flex-wrap: wrap;
                justify-content:flex-end;
            }
            .tw-btn{
                border:1px solid var(--border);
                background:#fff;
                color: var(--text);
                height: 36px;
                padding: 0 12px;
                border-radius: 12px;
                font-weight: 800;
                font-size: 12px;
                cursor:pointer;
                display:inline-flex;
                align-items:center;
                gap:8px;
            }
            .tw-btn.primary{
                border:none;
                background: var(--accent);
                color:#fff;
                box-shadow: 0 10px 22px rgba(255,107,134,.22);
            }
            .tw-btn.primary:hover{ background: var(--accentDeep); }

            .preview-wrap{
                display:flex;
                gap:10px;
                flex-wrap: wrap;
                margin-top: 12px;
            }
            .preview-item{
                width: 116px;
                position: relative;
            }
            .preview-img{
                width: 116px;
                height: 116px;
                border-radius: 16px;
                object-fit: cover;
                border: 1px solid var(--border);
                box-shadow: 0 6px 14px rgba(17,24,39,.08);
                background:#111827;
            }
            .preview-remove{
                position:absolute;
                top:-8px; right:-8px;
                width: 26px; height: 26px;
                border-radius: 999px;
                border: none;
                background: rgba(17,24,39,.84);
                color:#fff;
                font-weight: 900;
                cursor:pointer;
                display:flex;
                align-items:center;
                justify-content:center;
            }

            /* í¼ ê·¸ë¦¬ë“œ */
            .tw-grid{
                display:grid;
                grid-template-columns: 1.2fr .8fr;
                gap: 14px;
                margin-top: 14px;
            }
            @media (max-width: 860px){
                .tw-grid{ grid-template-columns: 1fr; }
            }

            .field{
                border: 1px solid var(--border);
                border-radius: 18px;
                padding: 14px;
                background:#fff;
            }
            .field label{
                display:flex;
                align-items:center;
                gap:8px;
                font-size: 13px;
                font-weight: 900;
                color: var(--text);
                margin-bottom: 10px;
            }
            .req{
                font-size: 11px;
                padding: 4px 8px;
                border-radius: 999px;
                background: rgba(255,107,134,.14);
                border:1px solid rgba(255,107,134,.22);
                color: var(--text);
                font-weight: 900;
            }
            .field input, .field select, .field textarea{
                width: 100%;
                border: 1px solid var(--border);
                border-radius: 14px;
                padding: 12px 12px;
                font-size: 13px;
                outline: none;
                background: #fff;
                color: var(--text);
            }
            .field textarea{
                min-height: 160px;
                resize: vertical;
                line-height: 1.6;
            }
            .field input:focus, .field select:focus, .field textarea:focus{
                border-color: rgba(99,102,241,.55);
                box-shadow: 0 0 0 3px rgba(99,102,241,.12);
            }

            .hint{
                margin-top: 8px;
                color: var(--sub);
                font-size: 12px;
            }

            /* í•˜ë‹¨ ê³ ì • ì•¡ì…˜ë°” */
            .tw-bottom{
                position: sticky;
                bottom: 0;
                margin-top: 14px;
                padding: 12px 0 0;
            }
            .tw-bottom-bar{
                background: rgba(255,255,255,.86);
                backdrop-filter: blur(10px);
                border: 1px solid var(--border);
                border-radius: 18px;
                box-shadow: var(--shadow);
                padding: 12px;
                display:flex;
                gap:10px;
                align-items:center;
                justify-content: space-between;
            }
            .tw-bottom-left{
                display:flex;
                flex-direction: column;
                gap:4px;
            }
            .tw-bottom-left .small{
                color: var(--sub);
                font-size: 12px;
            }
            .tw-bottom-left .big{
                color: var(--text);
                font-weight: 900;
                font-size: 13px;
            }
            .tw-actions{
                display:flex;
                gap:8px;
                flex-wrap: wrap;
                justify-content:flex-end;
            }

            .tw-submit{
                height: 40px;
                padding: 0 14px;
                border-radius: 14px;
                border: none;
                background: linear-gradient(135deg, var(--accent), var(--purple));
                color:#fff;
                font-weight: 900;
                cursor:pointer;
                box-shadow: 0 12px 26px rgba(99,102,241,.18);
                display:inline-flex;
                align-items:center;
                gap:8px;
                white-space: nowrap;
            }
            .tw-submit:hover{
                filter: brightness(.98);
            }

            .tw-cancel{
                height: 40px;
                padding: 0 14px;
                border-radius: 14px;
                border: 1px solid var(--border);
                background:#fff;
                color: var(--text);
                font-weight: 900;
                cursor:pointer;
                display:inline-flex;
                align-items:center;
                gap:8px;
                white-space: nowrap;
            }
        </style>
    </th:block>
</head>

<body>
<div layout:fragment="content">

    <div class="trade-write-wrap">

        <!-- âœ… memberId ì—†ìœ¼ë©´ (ë¡œê·¸ì¸ ì„¸ì…˜ ì—†ìœ¼ë©´) actionì´ ê¹¨ì§ˆ ìˆ˜ ìˆì–´ì„œ ì•ˆë‚´ -->
        <div th:if="${memberId == null}"
             style="background:#fff;border:1px solid var(--border);border-radius:18px;padding:14px;color:#111827;margin:10px 0;">
            âš ï¸ ë¡œê·¸ì¸ í›„ ì´ìš© ë°”ëë‹ˆë‹¤. <br/>
        </div>

        <div class="tw-head">
            <h1 class="tw-title" th:text="${mode} == 'edit' ? 'ì¿ ì¿ ë§ˆì¼“ ê¸€ ìˆ˜ì •' : 'ì¿ ì¿ ë§ˆì¼“ ê¸€ì“°ê¸°'">ì¿ ì¿ ë§ˆì¼“ ê¸€ì“°ê¸°</h1>
            <p class="tw-sub">ì‚¬ì§„ + í•µì‹¬ ì •ë³´ë§Œ ë”± ì •ë¦¬í•˜ë©´, ì‚¬ëŒë“¤ì´ ë°”ë¡œ ë¬¸ì˜í•´!</p>

            <div class="tw-badges">
                <span class="tw-pill pink">ğŸ“¦ êµ¿ì¦ˆ ê±°ë˜</span>
                <span class="tw-pill purple">ğŸ’¬ ì±„íŒ… ì—°ê²°</span>
                <span class="tw-pill">ğŸ‘€ ì¡°íšŒ/ì°œ/ì±„íŒ… í‘œì‹œ</span>
            </div>
        </div>

        <div class="tw-card">
            <div class="tw-card-inner">

                <!-- âœ… ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤í•‘ ê·¸ëŒ€ë¡œ ìœ ì§€: /trade/{memberId}/write  -->
                <form th:action="${mode} == 'edit' ?
                        @{/trade/{memberId}/article/{postId}/edit.do(memberId=${memberId}, postId=${postId})} :
                        @{/trade/{memberId}/write(memberId=${memberId})}"
                      th:object="${tradeWriteValid}"
                      method="post"
                      enctype="multipart/form-data">

                    <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
                    <div class="uploader" id="dropZone" onclick="document.getElementById('imgInput').click()">
                        <div class="uploader-row">
                            <div class="uploader-ico">ğŸ“¸</div>
                            <div>
                                <p class="uploader-title">ì‚¬ì§„ ì—…ë¡œë“œ (ì—¬ëŸ¬ ì¥ ê°€ëŠ¥)</p>
                                <p class="uploader-desc">í´ë¦­ ë˜ëŠ” ë“œë˜ê·¸ë¡œ ì—…ë¡œë“œ Â· ì²« ì‚¬ì§„ì´ ëŒ€í‘œ ëŠë‚Œìœ¼ë¡œ ë³´ì—¬ì§ˆ ìˆ˜ ìˆì–´!</p>
                            </div>
                            <div class="uploader-actions">
                                <button type="button" class="tw-btn" onclick="event.stopPropagation(); document.getElementById('imgInput').click();">
                                    â• ì‚¬ì§„ ì¶”ê°€
                                </button>
                                <button type="button" class="tw-btn primary" onclick="event.stopPropagation(); clearImages();">
                                    ğŸ§¹ ì´ˆê¸°í™”
                                </button>
                            </div>
                        </div>

                        <input type="file"
                               id="imgInput"
                               name="images"
                               accept="image/*"
                               multiple
                               style="display:none">
                        <div class="preview-wrap" id="previewArea"></div>
                    </div>

                    <!-- í¼ ê·¸ë¦¬ë“œ -->
                    <div class="tw-grid">

                        <!-- ì™¼ìª½(ë©”ì¸) -->
                        <div style="display:flex;flex-direction:column;gap:14px;">

                            <div class="field">
                                <label>ì œëª© <span class="req">í•„ìˆ˜</span></label>
                                <input type="text" th:field="*{title}" placeholder="ì˜ˆ) [í•˜ì´í] GEM ì†ë°”ë‹¥ í”¼ê·œì–´ ë¯¸ì•¼ ì•„ì¸ ë¬´" required>
                                <div class="hint">ì‚¬ëŒë“¤ì´ ê²€ìƒ‰í•˜ëŠ” í‚¤ì›Œë“œë¥¼ ì œëª©ì— ë„£ì–´ì£¼ë©´ ì¡°íšŒìˆ˜ í™• ì˜¬ë¼ê°€!</div>
                            </div>

                            <div class="field">
                                <label>ì„¤ëª… <span class="req">í•„ìˆ˜</span></label>
                                <textarea th:field="*{content}"
                                          placeholder="â€¢ ìƒí’ˆ ìƒíƒœ(ë¯¸ê°œë´‰/í•˜ì ìœ ë¬´)&#10;â€¢ êµ¬ì„±í’ˆ&#10;â€¢ ê±°ë˜ ê°€ëŠ¥ ì‹œê°„/ì¥ì†Œ&#10;â€¢ ë„¤ê³  ê°€ëŠ¥ ì—¬ë¶€"
                                          required></textarea>
                            </div>

                        </div>

                        <!-- ì˜¤ë¥¸ìª½(ì„œë¸Œ) -->
                        <div style="display:flex;flex-direction:column;gap:14px;">

                            <div class="field">
                                <label>ê°€ê²©</label>
                                <input type="number" th:field="*{price}" placeholder="ì˜ˆ) 15000" min="0">
                                <div class="hint">0 ë˜ëŠ” ë¹„ìš°ë©´ â€œê°€ê²©ë¬¸ì˜â€ë¡œ ì²˜ë¦¬í•  ìˆ˜ë„ ìˆì–´!</div>
                            </div>

                            <div class="field">
                                <label>ì¹´í…Œê³ ë¦¬</label>
                                <select th:field="*{category}">
                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    <option value="í¬ì¹´">í¬ì¹´</option>
                                    <option value="í”¼ê·œì–´">í”¼ê·œì–´</option>
                                    <option value="ì•„í¬ë¦´">ì•„í¬ë¦´</option>
                                    <option value="í‚¤ë§">í‚¤ë§</option>
                                    <option value="ë±ƒì§€">ë±ƒì§€</option>
                                    <option value="ê¸°íƒ€êµ¿ì¦ˆ">ê¸°íƒ€êµ¿ì¦ˆ</option>
                                </select>
                            </div>

                            <div class="field">
                                <label>ì§€ì—­</label>
                                <input type="text" th:field="*{region}" placeholder="ì˜ˆ) í™ëŒ€ / í•©ì • / ì‹ ì´Œ / ê°•ë‚¨">
                            </div>

                            <div class="field">
                                <label>ê±°ë˜ ë°©ì‹</label>
                                <select th:field="*{tradeMethod}">
                                    <option value="DIRECT">ì§ê±°ë˜</option>
                                    <option value="DELIVERY">íƒë°°ê±°ë˜</option>
                                    <option value="BOTH">ì§ê±°ë˜ + íƒë°°</option>
                                </select>
                            </div>

                            <div class="field">
                                <label>ê±°ë˜ ìƒíƒœ</label>
                                <select th:field="*{status}">
                                    <option value="ON_SALE">íŒë§¤ì¤‘</option>
                                    <option value="RESERVED">ì˜ˆì•½ì¤‘</option>
                                    <option value="DONE">íŒë§¤ì™„ë£Œ</option>
                                </select>
                            </div>

                        </div>
                    </div>

                    <!-- í•˜ë‹¨ ì•¡ì…˜ë°” -->
                    <div class="tw-bottom">
                        <div class="tw-bottom-bar">
                            <div class="tw-bottom-left">
                                <div class="small">ì¿ ì¿ ë§ˆì¼“</div>
                                <div class="big" th:text="${mode} == 'edit' ? 'ìˆ˜ì • ë‚´ìš©ì„ ì €ì¥í• ê¹Œìš”?' : 'ì‘ì„±í•œ ê¸€ì„ ë“±ë¡í• ê¹Œìš”?'">ì‘ì„±í•œ ê¸€ì„ ë“±ë¡í• ê¹Œìš”?</div>
                            </div>
                            <div class="tw-actions">
                                <a class="tw-cancel" th:href="@{/trade/list.do}">
                                    â†© ëª©ë¡ìœ¼ë¡œ
                                </a>
                                <button class="tw-submit" type="submit">
                                    <span th:text="${mode} == 'edit' ? 'âœ… ìˆ˜ì • ì €ì¥' : 'âœ… ë“±ë¡í•˜ê¸°'">âœ… ë“±ë¡í•˜ê¸°</span>
                                </button>
                            </div>
                        </div>
                    </div>

                </form>

            </div>
        </div>

    </div>

</div>

<script layout:fragment="script">
    const imgInput = document.getElementById("imgInput");
    const previewArea = document.getElementById("previewArea");
    const dropZone = document.getElementById("dropZone");

    let selectedFiles = [];

    imgInput.addEventListener("change", (e) => {
        const files = Array.from(e.target.files || []);
        selectedFiles = files;
        renderPreview();
    });

    function renderPreview() {
        previewArea.innerHTML = "";

        selectedFiles.forEach((file, idx) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const wrap = document.createElement("div");
                wrap.className = "preview-item";
                wrap.innerHTML = `
                    <img src="${e.target.result}" class="preview-img" alt="preview">
                    <button type="button" class="preview-remove" onclick="removeImg(${idx})">Ã—</button>
                `;
                previewArea.appendChild(wrap);
            };
            reader.readAsDataURL(file);
        });
    }

    function removeImg(index) {
        selectedFiles.splice(index, 1);

        const dt = new DataTransfer();
        selectedFiles.forEach(f => dt.items.add(f));
        imgInput.files = dt.files;

        renderPreview();
    }

    function clearImages(){
        selectedFiles = [];
        imgInput.value = "";
        previewArea.innerHTML = "";
    }

    // ë“œë˜ê·¸&ë“œë ì—…ë¡œë“œ (ë·°ë§Œ)
    ["dragenter","dragover"].forEach(evt => {
        dropZone.addEventListener(evt, (e) => {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.add("dragover");
        });
    });
    ["dragleave","drop"].forEach(evt => {
        dropZone.addEventListener(evt, (e) => {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.remove("dragover");
        });
    });
    dropZone.addEventListener("drop", (e) => {
        const files = Array.from(e.dataTransfer.files || []).filter(f => f.type.startsWith("image/"));
        selectedFiles = files;

        const dt = new DataTransfer();
        selectedFiles.forEach(f => dt.items.add(f));
        imgInput.files = dt.files;

        renderPreview();
    });
</script>

</body>
</html>