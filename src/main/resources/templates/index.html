<!DOCTYPE html>
<html lang="ko"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{fragments/tkk_fragment/layout}">

<head>
    <th:block layout:fragment="head"></th:block>
</head>

<body>
<div layout:fragment="content">

    <!-- =============================
         ì£¼ë³€ êµ¿ì¦ˆë§¤ì¥ ì°¾ê¸°
    ============================== -->
    <section class="card map-section">
        <div class="card-header">
            <div class="card-title">
                <span>ì£¼ë³€ êµ¿ì¦ˆë§¤ì¥ ì°¾ê¸°</span>
                <span class="pill pill-blue">BETA</span>
            </div>
        </div>

        <div class="home-search-row">
            <div class="home-input">
                <span class="ico">ğŸ”</span>
                <input id="qPlace" type="text" placeholder="ì§€ì—­ì´ë‚˜ ë§¤ì¥ëª…ìœ¼ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”">
            </div>
            <div class="home-input">
                <span class="ico">ğŸ“¦</span>
                <input id="qGoods" type="text" placeholder="ì¬ê³  ê²€ìƒ‰ (ì˜ˆ: ì§„ê²©ì˜ ê±°ì¸)">
            </div>
            <button id="btnMyPos" type="button" class="home-loc-btn">
                <span>ğŸ“</span> í˜„ì¬ ìœ„ì¹˜
            </button>
        </div>

        <div class="home-map-grid">
            <div class="home-map">
                <iframe th:src="@{/goods/map}"
                        title="ë§¤ì¥ ì§€ë„"
                        loading="lazy"
                        style="width:100%; height:100%; border:none;">
                </iframe>
            </div>

            <aside class="home-store-panel">
                <div class="home-store-head">ë§¤ì¥ ëª©ë¡</div>
                <div id="mapSideList" class="home-store-body">
                    <div class="home-store-empty">
                        ê²€ìƒ‰í•˜ë©´ ì—¬ê¸°ì— ë§¤ì¥ ëª©ë¡ì´ ë– ìš”.
                    </div>
                </div>
            </aside>
        </div>
    </section>


    <!-- =============================
         ì§„í–‰ì¤‘ì¸ íŒì—…ìŠ¤í† ì–´
         (í•˜ì–€ ë°°ê²½ / ë¸”ë¡ê° ì œê±°)
    ============================== -->
    <section class="card popup-section">
        <div class="card-header">
            <div class="card-title">
                <span>ì§„í–‰ì¤‘ì¸ íŒì—…ìŠ¤í† ì–´</span>
                <span class="pill pill-purple">POP-UP</span>
            </div>

            <a class="btn-allview"
               th:href="@{/popupstore/list.do(page=0,size=10)}">
                ì „ì²´ë³´ê¸° <span style="font-weight:900;">â€º</span>
            </a>
        </div>

        <!-- Swiper -->
        <div class="swiper popupSwiper">
            <div class="swiper-wrapper">

                <div class="swiper-slide"
                     th:each="popup : ${popupList}"
                     th:onclick="'location.href=\'/popupstore/' + ${popup.id} + '/detail.do\''">

                    <div class="popup-card">

                        <!-- ì´ë¯¸ì§€ -->
                        <div class="popup-img"
                             th:style="${popup.bannerImageUrl != null}
                                ? |background-image:url(${popup.bannerImageUrl});|
                                : ''">

                            <!-- ìƒíƒœ ë±ƒì§€ -->
                            <div class="popup-badge"
                                 th:with="
        today=${T(java.time.LocalDate).now()},
        start=${popup.startDate},
        end=${popup.endDate},
        isActive=${start != null and end != null and (not today.isBefore(start)) and (not today.isAfter(end))},
        isUpcoming=${start != null and today.isBefore(start)}
     ">

    <span class="popup-dot"
          th:classappend="${isUpcoming} ? ' upcoming' : (${isActive} ? '' : ' ended')"></span>

                                <span th:if="${isUpcoming}">ì˜ˆì •</span>
                                <span th:if="${!isUpcoming and isActive}">ì§„í–‰ì¤‘</span>
                                <span th:if="${!isUpcoming and !isActive}">ì¢…ë£Œ</span>
                            </div>
                        </div>

                        <!-- ì •ë³´ -->
                        <div class="popup-info">
                            <p class="popup-title"
                               th:text="${popup.title}">
                                íŒì—… ì œëª©
                            </p>

                            <p class="popup-place"
                               th:text="${popup.placeName != null ? popup.placeName : popup.regionName}">
                                ì¥ì†Œëª…
                            </p>

                            <p class="popup-date"
                               th:text="|${popup.startDate} ~ ${popup.endDate}|">
                                ê¸°ê°„
                            </p>

                            <!-- ê²€ì • ë²„íŠ¼ -->
                            <a class="popup-cta"
                               th:href="@{|/popupstore/${popup.id}/detail.do|}"
                               onclick="event.stopPropagation();">
                                ìì„¸íˆ ë³´ê¸°
                            </a>
                        </div>
                    </div>
                </div>

            </div>

            <!-- ë„¤ë¹„ê²Œì´ì…˜ (ì´ë¯¸ì§€ ì•ˆ ê°€ë¦¬ì§€ ì•ŠìŒ, CSSë¡œ í•´ê²°) -->
            <div class="swiper-button-prev popup-nav"></div>
            <div class="swiper-button-next popup-nav"></div>
            <div class="swiper-pagination"></div>
        </div>
    </section>

    <!-- =============================
         ë¬¸ì˜ Â· AI ìƒë‹´
    ============================== -->
    <a th:href="@{/help}" class="fab">
        <span class="fab-icon">ğŸ’¬</span>
        <span class="fab-text">ë¬¸ì˜ Â· AI ìƒë‹´</span>
    </a>

</div>

<!-- =============================
     Script
============================== -->
<th:block layout:fragment="script">
    <script>
        document.addEventListener("DOMContentLoaded", () => {

            const popupSwiper = new Swiper(".popupSwiper", {
                slidesPerView: 3,
                slidesPerGroup: 1,
                spaceBetween: 24,
                centeredSlides: false,
                loop: true,
                speed: 650,
                grabCursor: true,
                loopAdditionalSlides: 6,

                navigation: {
                    nextEl: ".popupSwiper .swiper-button-next",
                    prevEl: ".popupSwiper .swiper-button-prev"
                },
                pagination: {
                    el: ".popupSwiper .swiper-pagination",
                    clickable: true
                },

                breakpoints: {
                    0:   { slidesPerView: 1.1, spaceBetween: 14 },
                    720: { slidesPerView: 2,   spaceBetween: 18 },
                    900: { slidesPerView: 3,   spaceBetween: 24 }
                }
            });

        });
    </script>
</th:block>

</body>
</html>