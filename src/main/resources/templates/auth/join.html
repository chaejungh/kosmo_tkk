<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>íšŒì›ê°€ì… | ë”ì¿ ì¿ </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        :root{
            --bg:#f6f7fb;
            --card:#ffffff;
            --text:#111827;
            --sub:#6b7280;
            --line:#e5e7eb;

            --brand:#ff4fa0;
            --brand-soft:#fff0f7;

            --btn:#ff4fa0;
            --btn-hover:#ff2f8e;

            --dark:#111827;

            --danger:#dc2626;
            --ok:#16a34a;

            --shadow: 0 20px 60px rgba(17, 24, 39, .10);
            --radius: 18px;
        }

        *{box-sizing:border-box;}
        body{
            margin:0;
            background:var(--bg);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
            color:var(--text);
        }

        .page{
            min-height:100vh;
            display:flex;
            justify-content:center;
            padding:40px 16px;
        }

        .wrap{
            width:620px;
            max-width:100%;
        }

        .top-link{
            display:inline-flex;
            align-items:center;
            gap:8px;
            color:var(--sub);
            text-decoration:none;
            font-size:13px;
            margin-bottom:14px;
        }

        .brand{
            text-align:center;
            margin-bottom:14px;
        }
        .logo-badge{
            width:56px;
            height:56px;
            border-radius:14px;
            background:var(--brand-soft);
            border:1px solid rgba(255,79,160,.25);
            display:inline-flex;
            align-items:center;
            justify-content:center;
            font-weight:900;
            color:var(--brand);
            letter-spacing:.04em;
            user-select:none;
            margin-bottom:10px;
        }
        .title{
            margin:0;
            font-size:20px;
            font-weight:900;
        }
        .subtitle{
            margin:6px 0 0;
            font-size:13px;
            color:var(--sub);
        }

        .card{
            background:var(--card);
            border:1px solid var(--line);
            border-radius:var(--radius);
            box-shadow:var(--shadow);
            padding:22px 22px 18px;
        }

        .alert{
            border-radius:14px;
            padding:12px 12px;
            font-size:13px;
            margin-bottom:12px;
            font-weight:800;
            text-align:center;
            background:#fdecea;
            color:#b91c1c;
            border:1px solid rgba(185,28,28,.15);
        }

        .form{
            display:flex;
            flex-direction:column;
            gap:14px;
        }

        .group{
            display:flex;
            flex-direction:column;
            gap:6px;
        }

        .label{
            font-size:12px;
            font-weight:900;
            color:#374151;
        }

        .input, .select{
            width:100%;
            height:44px;
            border:1px solid var(--line);
            border-radius:12px;
            padding:0 12px;
            font-size:14px;
            outline:none;
            transition:.15s;
            background:#fff;
        }
        .input:focus, .select:focus{
            border-color: rgba(255,79,160,.7);
            box-shadow: 0 0 0 4px rgba(255,79,160,.12);
        }

        .row{
            display:grid;
            grid-template-columns: 1fr 120px;
            gap:10px;
            align-items:center;
        }

        .row-3{
            display:grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap:10px;
        }

        .btn-inline{
            height:44px;
            border-radius:12px;
            border:none;
            cursor:pointer;
            font-weight:900;
            font-size:13px;
            display:flex;
            align-items:center;
            justify-content:center;
            background:var(--dark);
            color:#fff;
            transition:.12s;
            white-space:nowrap;
        }
        .btn-inline:hover{ filter:brightness(1.05); transform: translateY(-1px); }
        .btn-inline:active{ transform: translateY(0); }

        .msg{
            font-size:12px;
            margin-top:2px;
            color:transparent;
            opacity:0;
            transform: translateY(4px);
            transition: all .2s ease;
        }
        .msg.show{
            opacity:1;
            transform: translateY(0);
            color:inherit;
        }

        .toggle-row{
            display:grid;
            grid-template-columns: repeat(4, 1fr);
            gap:10px;
        }
        .toggle-btn{
            height:44px;
            border-radius:12px;
            border:1px solid var(--line);
            background:#fff;
            cursor:pointer;
            font-weight:900;
            font-size:13px;
            color:#374151;
            transition:.12s;
        }
        .toggle-btn.active{
            border-color: rgba(255,79,160,.7);
            background: rgba(255,79,160,.10);
            color:#b01262;
        }

        .terms{
            border-radius:14px;
            border:1px solid rgba(255,79,160,.25);
            background: var(--brand-soft);
            padding:12px 12px;
            display:flex;
            flex-direction:column;
            gap:10px;
        }
        .terms .all{
            font-weight:900;
            font-size:12px;
            color:#7a0f52;
        }
        .terms label{
            display:flex;
            align-items:center;
            gap:8px;
            font-size:12px;
            color:#6b7280;
        }
        .terms input[type="checkbox"]{
            width:14px;height:14px;
            accent-color: var(--brand);
        }

        .btn-join{
            margin-top:2px;
            width:100%;
            height:48px;
            border-radius:14px;
            border:none;
            cursor:pointer;
            font-weight:900;
            font-size:15px;
            background:var(--btn);
            color:#fff;
            transition:.12s;
        }
        .btn-join:hover{ background:var(--btn-hover); transform: translateY(-1px); }
        .btn-join:active{ transform: translateY(0); }

        .foot{
            text-align:center;
            margin-top:14px;
            font-size:12px;
            color:#9ca3af;
        }

        @media (max-width:480px){
            .card{ padding:18px 16px 16px; }
            .row{ grid-template-columns: 1fr 110px; }
            .toggle-row{ gap:8px; }
        }
    </style>
</head>

<body>
<div class="page">
    <div class="wrap">

        <a class="top-link" th:href="@{/}">
            â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
        </a>

        <div class="brand">
            <div class="logo-badge">TK</div>
            <h1 class="title">íšŒì›ê°€ì…</h1>
            <p class="subtitle">ì• ë‹ˆ ë•í›„ë“¤ê³¼ í•¨ê»˜í•´ìš” ğŸ‰</p>
        </div>

        <div class="card">

            <!-- âœ… joinError ìœ ì§€ -->
            <div th:if="${joinError}" class="alert">
                <span th:text="${joinError}"></span>
            </div>

            <form class="form" method="post" action="/auth/join">
                <!-- âœ… ê¸°ì¡´ hidden ìœ ì§€ -->
                <input type="hidden" name="gender" id="genderValue" value="ë‚¨ì">
                <input type="hidden" name="nationality" id="nationalityValue" value="ë‚´êµ­ì¸">
                <input type="hidden" name="email" id="emailFull">
                <input type="hidden" name="birth" id="birth">

                <!-- ì•„ì´ë”” + ì¤‘ë³µí™•ì¸ -->
                <div class="group">
                    <label class="label">ì•„ì´ë”” *</label>
                    <div class="row">
                        <input type="text" class="input" name="loginId" placeholder="ì•„ì´ë”” ì…ë ¥" th:value="${loginId}">
                        <button type="button" class="btn-inline" id="btnCheckId">ì¤‘ë³µí™•ì¸</button>
                    </div>
                    <p id="idCheckMessage" class="msg"></p>
                </div>

                <!-- ë¹„ë°€ë²ˆí˜¸ -->
                <div class="group">
                    <label class="label">ë¹„ë°€ë²ˆí˜¸ *</label>
                    <input type="password" class="input" id="pw" name="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                    <p id="pwMessage" class="msg"></p>
                </div>

                <!-- ë¹„ë°€ë²ˆí˜¸ í™•ì¸ -->
                <div class="group">
                    <label class="label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸ *</label>
                    <input type="password" class="input" id="pwConfirm" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥">
                    <p id="pwConfirmMessage" class="msg"></p>
                </div>

                <!-- ì´ë©”ì¼ -->
                <div class="group">
                    <label class="label">ì´ë©”ì¼ *</label>
                    <div class="row">
                        <input type="text" class="input" name="emailId" placeholder="ì´ë©”ì¼ ì•„ì´ë”” (ì˜ˆ: banana123)">
                        <select class="select" name="emailDomain" id="emailDomainSelect">
                            <option value="@naver.com">@naver.com</option>
                            <option value="@gmail.com">@gmail.com</option>
                            <option value="@daum.net">@daum.net</option>
                            <option value="@kakao.com">@kakao.com</option>
                            <option value="@outlook.com">@outlook.com</option>
                            <option value="custom">ì§ì ‘ ì…ë ¥</option>
                        </select>
                    </div>

                    <!-- âœ… ê¸°ì¡´ ê¸°ëŠ¥: ì§ì ‘ì…ë ¥(ì´ë¦„ë§Œ JSì™€ ë§ì¶¤) -->
                    <input type="text" class="input" id="customEmailInput"
                           placeholder="ë„ë©”ì¸ ì§ì ‘ ì…ë ¥ (ì˜ˆ: mymail.com)"
                           style="display:none; margin-top:8px;">
                    <p class="msg" id="msgEmail"></p>
                </div>

                <!-- ì´ë¦„(ë‹‰ë„¤ì„) -->
                <div class="group">
                    <label class="label">ì´ë¦„ *</label>
                    <input type="text" class="input" name="nickname" placeholder="ì´ë¦„ ì…ë ¥">
                    <p class="msg" id="msgName"></p>
                </div>

                <!-- ìƒë…„ì›”ì¼ -->
                <div class="group">
                    <label class="label">ìƒë…„ì›”ì¼ *</label>
                    <div class="row-3">
                        <select id="birthYear" class="select"></select>
                        <select id="birthMonth" class="select"></select>
                        <select id="birthDay" class="select"></select>
                    </div>
                    <p class="msg" id="msgBirth"></p>
                </div>

                <!-- âœ… í†µì‹ ì‚¬ ì„ íƒ ì‚­ì œ -->

                <!-- ì„±ë³„/êµ­ì  -->
                <div class="group">
                    <label class="label">ì„±ë³„ Â· êµ­ì </label>
                    <div class="toggle-row">
                        <button type="button" class="toggle-btn active">ë‚¨ì</button>
                        <button type="button" class="toggle-btn">ì—¬ì</button>
                        <button type="button" class="toggle-btn active">ë‚´êµ­ì¸</button>
                        <button type="button" class="toggle-btn">ì™¸êµ­ì¸</button>
                    </div>
                </div>

                <!-- âœ… íœ´ëŒ€ì „í™” ì‚­ì œ -->

                <!-- ì•½ê´€ -->
                <div class="group">
                    <div class="terms">
                        <div class="all">
                            <label style="cursor:pointer;">
                                <input type="checkbox" id="termsAll">
                                [í•„ìˆ˜] ì•½ê´€ ì „ì²´ ë™ì˜
                            </label>
                            <p class="msg" id="msgTerms" style="margin:6px 0 0;"></p>
                        </div>

                        <label><input type="checkbox" class="terms-check"><span>ê°œì¸ì •ë³´ ì´ìš©</span></label>
                        <label><input type="checkbox" class="terms-check"><span>í†µì‹ ì‚¬ ì´ìš©ì•½ê´€</span></label>
                        <label><input type="checkbox" class="terms-check"><span>ê³ ìœ ì‹ë³„ì •ë³´ ì²˜ë¦¬</span></label>
                        <label><input type="checkbox" class="terms-check"><span>ì¸ì¦ ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€</span></label>
                        <label><input type="checkbox" class="terms-check"><span>ë”ì¿ ì¿  ê°œì¸ì •ë³´ìˆ˜ì§‘ë™ì˜</span></label>
                    </div>
                </div>

                <button type="submit" class="btn-join">ê°€ì…í•˜ê¸°</button>
            </form>
        </div>

        <div class="foot">Â© 2024 THE KUKU. All rights reserved.</div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {

        // ë©”ì‹œì§€ ìš”ì†Œ
        const msgId = document.getElementById("idCheckMessage");
        const msgPw = document.getElementById("pwMessage");
        const msgPwConfirm = document.getElementById("pwConfirmMessage");
        const msgEmail = document.getElementById("msgEmail");
        const msgName = document.getElementById("msgName");
        const msgBirth = document.getElementById("msgBirth");
        const msgPhone = document.getElementById("msgPhone");
        const msgTerms = document.getElementById("msgTerms");

        const joinForm = document.querySelector(".form");

        const id = document.querySelector("input[name='loginId']");
        const pw = document.getElementById("pw");
        const pwConfirm = document.getElementById("pwConfirm");
        const emailId = document.querySelector("input[name='emailId']");
        const emailDomain = document.getElementById("emailDomainSelect");
        const customEmailInput = document.getElementById("customEmailInput");

        const name = document.querySelector("input[name='nickname']");
        const phone = document.querySelector("input[name='phone']");
        const termsAll = document.getElementById("termsAll");
        const termsChecks = document.querySelectorAll(".terms-check");

        const birthYear = document.getElementById("birthYear");
        const birthMonth = document.getElementById("birthMonth");
        const birthDay = document.getElementById("birthDay");
        const birthHidden = document.getElementById("birth");

        // =========================
        // âœ… ì´ë©”ì¼ ë„ë©”ì¸ custom ì…ë ¥ ì²˜ë¦¬ (ê¸°ëŠ¥ ìœ ì§€ + idë§Œ ë§ì¶¤)
        // =========================
        emailDomain.addEventListener("change", function () {
            if (this.value === "custom") {
                emailDomain.style.display = "none";
                customEmailInput.style.display = "block";
                customEmailInput.value = "";
                customEmailInput.focus();
            } else {
                emailDomain.style.display = "block";
                customEmailInput.style.display = "none";
                customEmailInput.value = "";
            }
        });

        // =========================
        // âœ… ìƒë…„ì›”ì¼ ì…€ë ‰íŠ¸ ìë™ ìƒì„± (ê¸°ëŠ¥ ìœ ì§€)
        // =========================
        for (let y = 1950; y <= 2050; y++) {
            birthYear.innerHTML += `<option value="${y}">${y}</option>`;
        }
        for (let m = 1; m <= 12; m++) {
            birthMonth.innerHTML += `<option value="${String(m).padStart(2, "0")}">${m}</option>`;
        }

        function updateBirthValue() {
            if (birthYear.value && birthMonth.value && birthDay.value) {
                birthHidden.value = birthYear.value + birthMonth.value + birthDay.value;
            }
        }

        function updateDays() {
            const year = parseInt(birthYear.value);
            const month = parseInt(birthMonth.value);
            const lastDay = new Date(year, month, 0).getDate();

            birthDay.innerHTML = "";
            for (let d = 1; d <= lastDay; d++) {
                const val = String(d).padStart(2, "0");
                birthDay.innerHTML += `<option value="${val}">${d}</option>`;
            }
            updateBirthValue();
        }

        birthYear.addEventListener("change", updateDays);
        birthMonth.addEventListener("change", updateDays);
        birthDay.addEventListener("change", updateBirthValue);

        updateDays(); // ì´ˆê¸° 1íšŒ

        // =========================
        // âœ… ì„±ë³„/êµ­ì  í† ê¸€ (ê¸°ëŠ¥ ìœ ì§€)
        // =========================
        const toggleButtons = document.querySelectorAll(".toggle-btn");

        toggleButtons.forEach(btn => {
            btn.addEventListener("click", () => {
                const text = btn.textContent.trim();

                if (text === "ë‚¨ì" || text === "ì—¬ì") {
                    document.getElementById("genderValue").value = text;
                    toggleButtons[0].classList.remove("active");
                    toggleButtons[1].classList.remove("active");
                }

                if (text === "ë‚´êµ­ì¸" || text === "ì™¸êµ­ì¸") {
                    document.getElementById("nationalityValue").value = text;
                    toggleButtons[2].classList.remove("active");
                    toggleButtons[3].classList.remove("active");
                }

                btn.classList.add("active");
            });
        });

        // =========================
        // âœ… ì•„ì´ë”” ì¤‘ë³µí™•ì¸ (ê¸°ëŠ¥ ìœ ì§€)
        // =========================
        document.getElementById("btnCheckId").addEventListener("click", function () {
            const loginId = document.querySelector("input[name='loginId']").value;

            if (!loginId) {
                msgId.style.color = "#dc2626";
                msgId.textContent = "ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                msgId.classList.add("show");
                return;
            }

            fetch(`/auth/check-id?loginId=` + loginId)
                .then(res => res.text())
                .then(result => {
                    if (result === "duplicate") {
                        msgId.style.color = "#dc2626";
                        msgId.textContent = "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.";
                    } else {
                        msgId.style.color = "#16a34a";
                        msgId.textContent = "ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.";
                    }
                    msgId.classList.add("show");
                });
        });

        // =========================
        // âœ… ì•½ê´€ ì „ì²´ë™ì˜ (ê¸°ëŠ¥ ìœ ì§€)
        // =========================
        termsAll.addEventListener("change", () => {
            const checked = termsAll.checked;
            termsChecks.forEach(chk => chk.checked = checked);
        });

        termsChecks.forEach(chk => {
            chk.addEventListener("change", () => {
                const allChecked = Array.from(termsChecks).every(c => c.checked);
                termsAll.checked = allChecked;
            });
        });

        // =========================
        // âœ… ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± (ê¸°ëŠ¥ ìœ ì§€)
        // =========================
        function validatePasswordRule(password) {
            const regex = /^(?=.*[!@#$%^&*()_+{}\[\]:;<>,.?/~\-])(?!.*\s).{8,}$/;
            return regex.test(password);
        }

        pw.addEventListener("input", () => {
            msgPw.classList.add("show");

            if (!validatePasswordRule(pw.value)) {
                msgPw.style.color = "#dc2626";
                msgPw.textContent = "íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•œ 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.";
            } else {
                msgPw.style.color = "#16a34a";
                msgPw.textContent = "ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.";
            }
        });

        pwConfirm.addEventListener("input", () => {
            msgPwConfirm.classList.add("show");

            if (pwConfirm.value !== pw.value) {
                msgPwConfirm.style.color = "#dc2626";
                msgPwConfirm.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
            } else {
                msgPwConfirm.style.color = "#16a34a";
                msgPwConfirm.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.";
            }
        });

        // =========================
        // âœ… submit ì‹œ ê²€ì¦ + email í•©ì¹˜ê¸° (ê¸°ëŠ¥ ìœ ì§€)
        // =========================
        joinForm.addEventListener("submit", function(event) {

            let isValid = true;

            // ì´ˆê¸°í™”
            document.querySelectorAll(".msg").forEach(msg => {
                msg.textContent = "";
                msg.classList.remove("show");
                msg.style.color = "";
            });

            // ì´ë©”ì¼ í•©ì¹˜ê¸°
            const emailIdVal = (emailId.value || "").trim();
            const emailDomainVal = emailDomain.value;

            if (emailIdVal && emailDomainVal) {
                if (emailDomainVal === "custom") {
                    const custom = (customEmailInput.value || "").trim();
                    document.getElementById("emailFull").value = custom ? (emailIdVal + "@" + custom) : "";
                } else {
                    document.getElementById("emailFull").value = emailIdVal + emailDomainVal;
                }
            }

            if (id.value.trim() === "") {
                msgId.style.color = "#dc2626";
                msgId.textContent = "ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                msgId.classList.add("show");
                isValid = false;
            }

            if (pw.value.trim() === "") {
                msgPw.style.color = "#dc2626";
                msgPw.textContent = "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                msgPw.classList.add("show");
                isValid = false;
            }

            if (!validatePasswordRule(pw.value)) {
                msgPw.style.color = "#dc2626";
                msgPw.textContent = "íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•œ 8ì ì´ìƒ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.";
                msgPw.classList.add("show");
                isValid = false;
            }

            if (pwConfirm.value.trim() === "") {
                msgPwConfirm.style.color = "#dc2626";
                msgPwConfirm.textContent = "ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.";
                msgPwConfirm.classList.add("show");
                isValid = false;
            }

            if (pw.value !== pwConfirm.value) {
                msgPwConfirm.style.color = "#dc2626";
                msgPwConfirm.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
                msgPwConfirm.classList.add("show");
                isValid = false;
            }

            // ì´ë©”ì¼
            if (!document.getElementById("emailFull").value) {
                msgEmail.style.color = "#dc2626";
                msgEmail.textContent = "ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                msgEmail.classList.add("show");
                isValid = false;
            }

            if (name.value.trim() === "") {
                msgName.style.color = "#dc2626";
                msgName.textContent = "ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                msgName.classList.add("show");
                isValid = false;
            }

            if (birthHidden.value.trim() === "") {
                msgBirth.style.color = "#dc2626";
                msgBirth.textContent = "ìƒë…„ì›”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.";
                msgBirth.classList.add("show");
                isValid = false;
            }

            if (!termsAll.checked) {
                msgTerms.style.color = "#dc2626";
                msgTerms.textContent = "í•„ìˆ˜ ì•½ê´€ì„ í™•ì¸í•˜ê³  ë™ì˜í•´ì£¼ì‹œë©´ ê°€ì…ì´ ì™„ë£Œë©ë‹ˆë‹¤.";
                msgTerms.classList.add("show");
                isValid = false;
            }

            if (!isValid) {
                event.preventDefault();
                window.scrollTo({ top: 0, behavior: "smooth" });
            }
        });

    });
</script>
</body>
</html>