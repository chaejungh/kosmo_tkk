<!DOCTYPE html>
<html lang="ko"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{fragments/fragments/layout}">

<head>
    <th:block layout:fragment="head">
        <style>
            :root{
                --bg:#f4f5f7;
                --card:#ffffff;
                --text:#111827;
                --sub:#6b7280;
                --border:#e5e7eb;

                --chip:#111827;
                --chipText:#fff;

                --hot:#ff5b7a;
                --hotText:#fff;

                --accent:#ff6b86;
                --accentDeep:#ff4d6d;

                --shadow: 0 6px 20px rgba(17,24,39,.06);
                --radius:18px;
            }

            *{box-sizing:border-box}

            .board-page-wrap{padding:18px 0 40px}
            /* âœ… í™ˆì²˜ëŸ¼ ë” ë„“ê²Œ(ì›í•˜ë©´ 1200/1400ìœ¼ë¡œ ì¡°ì ˆ ê°€ëŠ¥) */
            .board-shell{max-width:1320px;margin:0 auto;padding:0 16px}

            /* ===== ìƒë‹¨ íƒ€ì´í‹€ ===== */
            .board-title{font-size:28px;font-weight:800;color:var(--text);margin:0 0 6px}
            .board-subtitle{color:var(--sub);font-size:13px;margin:0 0 14px}

            /* ===== ì¹´í…Œê³ ë¦¬ Segmented ===== */
            .board-seg{
                display:flex;gap:10px;align-items:center;flex-wrap:wrap;
                margin-bottom:12px;
            }
            .board-seg-btn{
                border:1px solid var(--border);
                background:#fff;
                color:var(--text);
                font-size:13px;
                padding:10px 14px;
                border-radius:999px;
                cursor:pointer;
                display:flex;gap:8px;align-items:center;
                box-shadow:0 2px 10px rgba(17,24,39,.03);
            }
            .board-seg-btn.active{
                background:#111827;
                color:#fff;
                border-color:#111827;
            }

            /* ===============================
               âœ… ì „ì²´ 2ì—´: (ì™¼ìª½=ê²€ìƒ‰+ê¸€ / ì˜¤ë¥¸ìª½=ì¸ê¸°ê¸€)
               -> ì¸ê¸°ê¸€ì´ ë¹¨ê°„ ë™ê·¸ë¼ë¯¸ ìë¦¬ë¡œ ê°
            =============================== */
            .board-grid{
                display:grid;
                grid-template-columns: 1fr 280px;
                gap:18px;
                align-items:start;
            }
            @media (max-width: 1100px){
                .board-grid{grid-template-columns:1fr}
            }

            /* ===== ê²€ìƒ‰/ì•¡ì…˜ ë°” ===== */
            .board-toolbar{
                background:#fff;
                border:1px solid var(--border);
                border-radius:20px;
                padding:14px;
                box-shadow:var(--shadow);
                margin-bottom:16px;
            }
            .board-toolbar-row{
                display:flex;gap:12px;align-items:center;flex-wrap:wrap;
            }
            .board-search{
                flex:1;
                display:flex;align-items:center;gap:10px;
                border:1px solid var(--border);
                border-radius:999px;
                padding:10px 14px;
                min-width:260px;
            }
            .board-search .icon{color:var(--sub);font-size:14px}
            .board-search input{
                border:none;outline:none;background:transparent;
                width:100%;font-size:13px;color:var(--text);
            }

            .board-mini-actions{
                display:flex;align-items:center;gap:8px;margin-left:auto;
            }
            .icon-btn{
                width:38px;height:38px;border-radius:12px;
                border:1px solid var(--border);
                background:#fff;
                cursor:pointer;
                display:flex;align-items:center;justify-content:center;
                color:#111827;
            }
            .icon-btn.active{background:#111827;color:#fff;border-color:#111827}

            .sort-wrap{position:relative}
            .sort-menu{
                position:absolute;right:0;top:44px;
                background:#fff;border:1px solid var(--border);
                border-radius:14px;box-shadow:var(--shadow);
                padding:8px;min-width:140px;z-index:50;
            }
            .sort-menu.hidden{display:none}
            .sort-option{
                padding:10px 12px;border-radius:10px;
                cursor:pointer;font-size:13px;color:var(--text);
            }
            .sort-option:hover{background:#f3f4f6}
            .sort-option.active{background:#111827;color:#fff}

            .board-write-btn{
                border:none;
                border-radius:12px;
                padding:10px 14px;
                background:var(--accent);
                color:#fff;
                font-weight:700;
                cursor:pointer;
                box-shadow:0 8px 18px rgba(255,107,134,.25);
                white-space:nowrap;
            }
            .board-write-btn:hover{background:var(--accentDeep)}

            /* ===== ê²Œì‹œê¸€ ì¹´ë“œ(ê·¸ë¦¬ë“œ) ===== */
            .post-grid{
                display:grid;
                grid-template-columns:repeat(3, minmax(0,1fr)); /* âœ… 3ê°œ */
                gap:16px;
            }
            @media (max-width: 1100px){
                .post-grid{grid-template-columns:repeat(2, minmax(0,1fr))}
            }
            @media (max-width: 700px){
                .post-grid{grid-template-columns:1fr}
            }
            .post-grid.view-list{grid-template-columns:1fr}

            .post-card{
                background:#fff;border:1px solid var(--border);
                border-radius:18px;
                box-shadow:var(--shadow);
                overflow:hidden;
                text-decoration:none;
                color:inherit;
                display:flex;flex-direction:column;
                cursor:pointer;
            }
            .post-card:hover{transform:translateY(-1px)}
            .post-thumb{height:210px;background:#111827;display:block}
            .post-thumb img{width:100%;height:100%;object-fit:cover;display:block}
            .post-body{padding:14px 14px 12px}

            .post-chip-row{display:flex;gap:8px;align-items:center;margin-bottom:10px}
            .chip{
                background:var(--chip);
                color:var(--chipText);
                font-size:11px;
                padding:6px 10px;
                border-radius:999px;
                display:inline-flex;align-items:center;gap:6px;
            }
            .chip.hot{background:var(--hot);color:var(--hotText)}

            .post-title{
                font-weight:800;
                font-size:15px;
                line-height:1.25;
                margin:0 0 8px;
                color:var(--text);
            }
            .post-meta{
                display:flex;justify-content:space-between;gap:10px;
                color:var(--sub);
                font-size:12px;
                margin-bottom:10px;
            }
            .post-stats{
                display:flex;gap:12px;align-items:center;
                color:var(--sub);font-size:12px;
            }

            /* ===============================
               âœ… ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œ ì¸ê¸°ê¸€(ë¹¨ê°„ ë™ê·¸ë¼ë¯¸ ìë¦¬)
            =============================== */
            .hot-mini{
                width:100%;
                background: var(--card);
                border: 1px solid var(--border);
                border-radius: 14px;
                overflow: hidden;
                box-shadow: var(--shadow);
                position: sticky;
                top: 110px; /* í—¤ë” ì•„ë˜ë¡œ ì‚´ì§ */
            }
            @media (max-width: 1100px){
                .hot-mini{position:static; top:auto}
            }

            .hot-mini-head{
                background:#111;
                color:#fff;
                padding: 10px 12px;
                font-weight: 900;
                font-size: 13px;
                display:flex;
                align-items:center;
                gap:8px;
            }
            .hot-mini-list{list-style:none;margin:0;padding:0;}
            .hot-mini-list > li{border-top:1px solid var(--border);}

            .hot-mini-link{
                display:flex;
                gap:8px;
                padding:10px 12px;
                text-decoration:none;
                color:inherit;
            }
            .hot-mini-link:hover{background:#f3f4f6}

            .hot-mini-rank{
                width:22px;height:22px;border-radius:999px;
                background: var(--hot);
                color:#fff;
                font-weight:900;
                display:flex;align-items:center;justify-content:center;
                font-size:11px;
                flex:none;
            }
            .hot-mini-title{
                font-size:12px;
                font-weight:800;
                color:var(--text);
                white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
                margin-bottom:4px;
                max-width: 190px;
            }
            .hot-mini-stats{
                font-size:11px;color:var(--sub);
                display:flex;gap:8px;
            }

            /* ===== í˜ì´ì§• ===== */
            .pager-wrap{margin-top:18px;display:flex;justify-content:center}
            .tkk-paging{list-style:none;margin:0;padding:0;display:flex;gap:10px;align-items:center}
            .tkk-paging .page-link{
                display:inline-flex;align-items:center;justify-content:center;
                min-width:40px;height:40px;padding:0 14px;border-radius:999px;
                border:1px solid var(--border);background:#fff;color:var(--text);
                text-decoration:none;font-weight:700;box-shadow:var(--shadow);
            }
            .tkk-paging .page-item.active .page-link{
                background:var(--accent);
                border-color:var(--accent);
                color:#fff;
            }
            .tkk-paging .page-item.disabled .page-link{
                opacity:.4;pointer-events:none;box-shadow:none
            }

            /* ===== ëª¨ë°”ì¼ í”Œë¡œíŒ… ê¸€ì“°ê¸° ===== */
            .floating-write-btn{
                position:fixed;
                right:18px; bottom:18px;
                width:52px;height:52px;
                border-radius:999px;
                border:none;
                background:var(--accent);
                color:#fff;font-size:28px;
                display:flex;align-items:center;justify-content:center;
                box-shadow:0 14px 28px rgba(255,107,134,.35);
                cursor:pointer;
            }
            @media (min-width: 981px){
                .floating-write-btn{display:none}
            }
        </style>
    </th:block>
</head>

<body>
<div layout:fragment="content">

    <section class="board-page-wrap">
        <div class="board-shell">

            <div class="board-title">ì†ë‹¥ì†ë‹¥ ê²Œì‹œíŒ</div>
            <div class="board-subtitle">ì• ë‹ˆë¥¼ ì‚¬ë‘í•˜ëŠ” ìš°ë¦¬ë“¤ì˜ ì´ì•¼ê¸°</div>

            <!-- ì¹´í…Œê³ ë¦¬ -->
            <div class="board-seg">
                <button class="board-seg-btn"
                        type="button"
                        th:onclick="|location.href='@{/board/1/list.do}'|"
                        th:classappend="${categoryId} == 1 ? ' active' : ''">âœ¨ ë‚´ìƒˆë¼ìë‘</button>

                <button class="board-seg-btn"
                        type="button"
                        th:onclick="|location.href='@{/board/2/list.do}'|"
                        th:classappend="${categoryId} == 2 ? ' active' : ''">ğŸ§¸ ì½”ìŠ¤í”„ë ˆ</button>

                <button class="board-seg-btn"
                        type="button"
                        th:onclick="|location.href='@{/board/3/list.do}'|"
                        th:classappend="${categoryId} == 3 ? ' active' : ''">ğŸ’¬ ììœ ê²Œì‹œíŒ</button>
            </div>

            <!-- âœ… ì™¼ìª½(ê²€ìƒ‰+ê¸€) / ì˜¤ë¥¸ìª½(ì¸ê¸°ê¸€) -->
            <div class="board-grid">

                <!-- =======================
                     LEFT: ê²€ìƒ‰ + ê¸€ëª©ë¡
                ======================== -->
                <div>

                    <div class="board-toolbar">
                        <div class="board-toolbar-row">

                            <form th:action="@{/board/list.do}" method="post" style="flex:1; min-width:260px;">
                                <div class="board-search">
                                    <span class="icon">ğŸ”</span>
                                    <input name="search" type="text" placeholder="ê²Œì‹œê¸€ ê²€ìƒ‰" th:value="${search}">
                                </div>
                            </form>

                            <div class="board-mini-actions">
                                <form th:action="@{/board/{categoryId}/list.do(categoryId=${categoryId})}"
                                      method="get"
                                      style="display:flex; align-items:center; gap:6px;">

                                    <select name="size"
                                            onchange="this.form.submit()"
                                            style="height:38px;
                                    border-radius:12px;
                                    border:1px solid var(--border);
                                    padding:0 10px;
                                    font-weight:700;
                                    font-size:13px;">
                                        <option value="5"  th:selected="${posts.size == 5}">5ê°œì”©</option>
                                        <option value="10" th:selected="${posts.size == 10}">10ê°œì”©</option>
                                        <option value="20" th:selected="${posts.size == 20}">20ê°œì”©</option>
                                        <option value="30" th:selected="${posts.size == 30}">30ê°œì”©</option>
                                    </select>

                                    <!-- ìƒíƒœ ìœ ì§€ -->
                                    <input type="hidden" name="page" value="0"/>
                                    <input type="hidden" name="sort" th:value="${param.sort}"/>
                                </form>



                                <button id="viewListBtn" class="icon-btn" type="button" title="ë¦¬ìŠ¤íŠ¸">â‰¡</button>
                                <button id="viewPhotoBtn" class="icon-btn active" type="button" title="ê·¸ë¦¬ë“œ">â–¢</button>

                                <div class="sort-wrap">
                                    <button id="sortBtn" class="icon-btn" type="button" title="ì •ë ¬">â‡…</button>
                                    <div id="sortMenu" class="sort-menu hidden">
                                        <div class="sort-option" data-sort="latest"
                                             th:classappend="${sortType} == 'latest'? 'active': ''">ìµœì‹ ìˆœ</div>
                                        <div class="sort-option" data-sort="popular"
                                             th:classappend="${sortType} == 'popular'? 'active': ''">ì¸ê¸°ìˆœ</div>
                                    </div>
                                </div>
                            </div>

                            <!-- ê¸€ì“°ê¸° -->
                            <button class="board-write-btn"
                                    th:if="${session.loginMember != null}"
                                    th:onclick="|location.href='@{/board/{memberId}/write(memberId=${memberId})}'|"
                                    type="button">ê¸€ì“°ê¸°</button>

                            <button class="board-write-btn"
                                    th:if="${session.loginMember == null}"
                                    th:onclick="|location.href='@{/auth/login}'|"
                                    type="button">ê¸€ì“°ê¸°</button>
                        </div>
                    </div>

                    <!-- âœ… ê²€ìƒ‰ ë°‘ì— ë°”ë¡œ 3ê°œ ê²Œì‹œê¸€ -->
                    <div id="boardRoot">

                        <div class="post-grid" id="postList" th:if="${not #lists.isEmpty(posts)}">
                            <div class="post-card"
                                 th:each="post : ${posts.content}"
                                 th:attr="data-post-id=${post.id}">

                                <a class="post-thumb" href="javascript:void(0)">
                                    <img th:src="${post.thumbnailUrl != null ? post.thumbnailUrl : '/images/dummy/noimg.png'}"
                                         alt="ì¸ë„¤ì¼">
                                </a>

                                <div class="post-body">
                                    <div class="post-chip-row">
                                        <span class="chip" th:text="${post.category.name}">ì¹´í…Œê³ ë¦¬</span>
                                        <span class="chip hot">HOT</span>
                                    </div>

                                    <div class="post-title" th:text="${post.title}">ì œëª©</div>

                                    <div class="post-meta">
                    <span>
                      <b th:text="${post.member.nickname}">ë‹‰ë„¤ì„</b>
                      Â·
                      <span th:text="${#temporals.format(post.createdAt,'yyyy.MM.dd')}">2025.01.01</span>
                    </span>
                                        <span th:text="${post.category.name}">ì¹´í…Œê³ ë¦¬</span>
                                    </div>

                                    <div class="post-stats">
                                        <span>ğŸ‘€ <b th:text="${post.viewCount}">0</b></span>
                                        <span>â¤ï¸ <b th:text="${post.likeCount}">0</b></span>
                                        <span>ğŸ’¬ <b th:text="${post.commentCount}">0</b></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div th:if="${#lists.isEmpty(posts)}" style="padding:30px;color:var(--sub);text-align:center;">
                            ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                        </div>

                        <!-- í˜ì´ì§•(ê¸°ì¡´ ë¡œì§ ìœ ì§€) -->
                        <div class="pager-wrap"
                             th:with="page=${posts.number}, last=${posts.totalPages}, size=${param.size}">
                            <nav th:with="start=${ page - 2 < 0 ? 0 : page - 2 }, end=${ page + 3 > last ? last : page + 3 }">
                                <ul class="tkk-paging">
                                    <li class="page-item" th:classappend="${page}==0 ? 'disabled' : '' ">
                                        <a th:href="@{'?'(page=0,size=${size})}" class="page-link">start</a>
                                    </li>

                                    <li th:each="i : ${#numbers.sequence(start+1,end)}"
                                        th:classappend="( (${i}-1)==${page}?'active' )"
                                        class="page-item">
                                        <a th:href="@{'?'(page=(${i}-1), size=${size})}"
                                           class="page-link"
                                           th:text="${i}"></a>
                                    </li>

                                    <li class="page-item" th:classappend="${page}==(${last}-1) ? 'disabled' : '' ">
                                        <a th:href="@{'?'(page=${last}-1,size=${size})}" class="page-link">last</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>

                    </div>
                </div>

                <!-- =======================
                     RIGHT: ì¸ê¸°ê¸€ (ë¹¨ê°„ ë™ê·¸ë¼ë¯¸ ìë¦¬)
                ======================== -->
                <aside class="hot-mini"
                       th:if="${not #lists.isEmpty(hotCurrentBoard) or not #lists.isEmpty(hotAllBoard)}">
                    <div class="hot-mini-head">ğŸ“ˆ ì¸ê¸°ê¸€</div>

                    <ul class="hot-mini-list">

                        <!-- í˜„ì¬ ê²Œì‹œíŒ ì¸ê¸°ê¸€ ìš°ì„  -->
                        <th:block th:if="${not #lists.isEmpty(hotCurrentBoard)}"
                                  th:each="p,stat : ${hotCurrentBoard}">
                            <li th:if="${stat.index < 3}">
                                <a class="hot-mini-link"
                                   th:href="${memberId != null} ?
                     @{'/board/' + ${memberId} + '/article/' + ${p.id} + '/detail.do'} :
                     @{/board/not-allowed}">
                                    <div class="hot-mini-rank" th:text="${stat.index + 1}">1</div>
                                    <div>
                                        <div class="hot-mini-title" th:text="${p.title}">ì œëª©</div>
                                        <div class="hot-mini-stats">
                                            <span>ğŸ‘€ <b th:text="${p.viewCount}">0</b></span>
                                            <span>â¤ï¸ <b th:text="${p.likeCount}">0</b></span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                        </th:block>

                        <!-- ì—†ìœ¼ë©´ ì „ì²´ ì¸ê¸°ê¸€ -->
                        <th:block th:if="${#lists.isEmpty(hotCurrentBoard)}"
                                  th:each="p,stat : ${hotAllBoard}">
                            <li th:if="${stat.index < 3}">
                                <a class="hot-mini-link"
                                   th:href="${memberId != null} ?
                     @{'/board/' + ${memberId} + '/article/' + ${p.id} + '/detail.do'} :
                     @{/board/not-allowed}">
                                    <div class="hot-mini-rank" th:text="${stat.index + 1}">1</div>
                                    <div>
                                        <div class="hot-mini-title" th:text="${p.title}">ì œëª©</div>
                                        <div class="hot-mini-stats">
                                            <span>ğŸ‘€ <b th:text="${p.viewCount}">0</b></span>
                                            <span>â¤ï¸ <b th:text="${p.likeCount}">0</b></span>
                                        </div>
                                    </div>
                                </a>
                            </li>
                        </th:block>

                    </ul>
                </aside>

            </div>
        </div>
    </section>

    <!-- ëª¨ë°”ì¼ í”Œë¡œíŒ… ê¸€ì“°ê¸° -->
    <button class="floating-write-btn"
            th:if="${memberId != null}"
            th:onclick="|location.href='@{/board/{memberId}/write(memberId=${memberId})}'|"
            type="button">ï¼‹</button>

    <button class="floating-write-btn"
            th:if="${memberId == null}"
            th:onclick="|location.href='@{/board/not-allowed}'|"
            type="button">ï¼‹</button>

</div>

<script th:inline="javascript" layout:fragment="script">
    document.addEventListener('DOMContentLoaded', () => {

        const viewListBtn = document.getElementById("viewListBtn");
        const viewPhotoBtn = document.getElementById("viewPhotoBtn");

        const memberId = /*[[${memberId}]]*/ null;

        // ì¹´ë“œ í´ë¦­ â†’ ìƒì„¸
        document.querySelectorAll('.post-card').forEach(card => {
            card.addEventListener('click', () => {
                const postId = card.dataset.postId;
                if (memberId == null) {
                    window.location.href = "/board/not-allowed";
                    return;
                }
                window.location.href = `/board/${memberId}/article/${postId}/detail.do`;
            });
        });

        // ë³´ê¸° ëª¨ë“œ
        viewListBtn?.addEventListener("click", () => {
            document.getElementById("postList")?.classList.add("view-list");
            viewListBtn.classList.add("active");
            viewPhotoBtn.classList.remove("active");
        });

        viewPhotoBtn?.addEventListener("click", () => {
            document.getElementById("postList")?.classList.remove("view-list");
            viewPhotoBtn.classList.add("active");
            viewListBtn.classList.remove("active");
        });

        // ì •ë ¬ ë©”ë‰´
        const sortBtn = document.getElementById("sortBtn");
        const sortMenu = document.getElementById("sortMenu");
        const sortOptions = document.querySelectorAll(".sort-option");

        sortBtn?.addEventListener("click", (e) => {
            e.stopPropagation();
            sortMenu.classList.toggle("hidden");
        });

        document.addEventListener("click", () => {
            sortMenu.classList.add("hidden");
        });

        // ì •ë ¬ ì ìš©(ê¸°ì¡´ ë¡œì§ ìœ ì§€)
        sortOptions.forEach(option => {
            option.addEventListener('click', () => {
                sortOptions.forEach(o => o.classList.remove("active"));
                option.classList.add("active");

                const sortType = option.dataset.sort;
                const url = new URL(window.location.href);

                if (sortType === 'latest') url.searchParams.set('sort', 'createdAt,desc');
                if (sortType === 'popular') url.searchParams.set('sort', 'likeCount,desc');

                url.searchParams.set('page', 0);
                window.location.href = url.toString();
            });
        });

    });
</script>

</body>
</html>