<!DOCTYPE html>
<html lang="ko"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{fragments/layout}">
<head></head>
<body>



<div class="page board-page" layout:fragment="content">
    <div class="page-inner">

<!--        &lt;!&ndash; ìƒë‹¨ ë¡œê³  + ë’¤ë¡œê°€ê¸° &ndash;&gt;-->
<!--        <header class="header">-->
<!--            <div class="detail-header-bar">-->
<!--                <button type="button"-->
<!--                        class="detail-back-btn"-->
<!--                        onclick="history.back()">-->
<!--                    â†-->
<!--                </button>-->
<!--                <div class="detail-logo">ë”ì¿ ì¿ </div>-->
<!--            </div>-->
<!--        </header>-->

        <!-- ============ ìƒì„¸ ì¹´ë“œ ============ -->
        <section class="card post-detail-card">
            <div class="post-detail-header">
                <div class="detail-profile-photo">
                    <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì´ë¯¸ì§€, ì—†ìœ¼ë©´ 'í”„ë¡œí•„' ê¸€ì -->
                    <img th:if="${post.member.profileImageUrl} != null"
                         th:src="${post.member.profileImageUrl}"
                         alt="í”„ë¡œí•„"
                         style="width:40px; height:40px; border-radius:50%; object-fit:cover;" >
                    <span th:if="${post.member.profileImageUrl} == null">í”„ë¡œí•„</span>
                </div>
                <div class="detail-profile-meta">
                    <!-- ë‹‰ë„¤ì„ -->
                    <div class="detail-nickname"
                         th:text="${post.member.nickname}">
                        íˆë¡±ì´
                    </div>
                    <!-- ì‘ì„±ì¼ Â· ì¹´í…Œê³ ë¦¬ëª… -->
                    <div class="detail-sub-meta">
                        <span th:text="${#temporals.format(post.createdAt, 'yyyy.MM.dd')}">
                            3ë¶„ ì „
                        </span>
                        Â·
                        <span th:text="${post.category.name}">
                        </span>
                    </div>
                </div>
            </div>

            <!-- ëŒ€í‘œ ì‚¬ì§„ -->
            <div class="detail-main-image">
                <!-- thumbnailUrlì´ ìˆìœ¼ë©´ ëŒ€í‘œì‚¬ì§„ìœ¼ë¡œ ì‚¬ìš© -->
                <img th:if="${post.thumbnailUrl} != null"
                     th:src="${post.thumbnailUrl}"
                     alt="ëŒ€í‘œ ì‚¬ì§„"
                     style="width:100%; height:100%; object-fit:cover;">
                <div th:if="${post.thumbnailUrl} == null">
                    ëŒ€í‘œ ì‚¬ì§„ ì˜ì—­
                </div>

                <!-- ì´ë¯¸ì§€ ê°œìˆ˜ëŠ” ì¼ë‹¨ 1 / 1 -->
                <div class="detail-image-count">
                    <span>1 / 1</span>
                </div>
            </div>

            <!-- ì¢‹ì•„ìš” / ëŒ“ê¸€ / ì €ì¥ / ì¡°íšŒìˆ˜ + ê³µìœ  -->
            <div class="detail-stats-row">
                <div class="detail-stats-left">
                    <div class="detail-stat-item">
                        <button type="button"
                        id="like-btn"
                        class="like-btn"
                        th:data-post-id="${post.id}"
                        th:data-member-id="${memberId}"
                        th:data-liked="${likeInfo.id != null}">
                            â¤ï¸
                        </button>
                        <span id="like-count" th:text="${post.likeCount}">0</span>

                    </div>
                    <div class="detail-stat-item">
                        ğŸ’¬ <span th:text="${commentCount}"></span>
                    </div>
                    <div class="detail-stat-item">
                        ğŸ“Œ <span>ì €ì¥</span>
                    </div>
                    <div class="detail-stat-item">
                        ğŸ‘€ <span th:text="${post.viewCount}">0</span>
                    </div>
                </div>
                <button type="button" class="detail-share-btn">ğŸ“¤</button>
            </div>

            <!-- ê¸€ ë‚´ìš© -->
            <div class="detail-content-title"
                 th:text="${post.title}">
                ì˜¤ëŠ˜ ì˜ì—…ë‹¹í•œ ë‚´ ìµœì•  í¬ì¹´ ìë‘í•©ë‹ˆë‹¤ ğŸ¥¹
            </div>

            <!-- ê°œí–‰ ë³´ì¡´: \n â†’ <br> -->
            <div class="detail-content-body"
                 th:utext="${#strings.replace(post.content, '\n', '<br/>')}">
                ì˜¤ëŠ˜ ì˜ì—…ë‹¹í•œ ë‚´ ìµœì•  í¬ì¹´ ìë‘ ê¸€ì´ì—ìš”.
                ì‹¤ë¬¼ì´ í›¨ì”¬ ì˜ˆì˜ê³ , ì‚¬ì§„ìœ¼ë¡œëŠ” ë‹¤ ì•ˆ ë‹´ê¸°ëŠ” ëŠë‚Œâ€¦
                ê°™ì€ ë•í›„ ë¶„ë“¤ê³¼ ê°™ì´ ê³µìœ í•˜ê³  ì‹¶ì–´ì„œ ì˜¬ë ¤ìš”!
            </div>

            <!-- íƒœê·¸ -->
            <div class="detail-content-tags">
                <!-- ì¼ë‹¨ ì¹´í…Œê³ ë¦¬ë§Œ ê°„ë‹¨íˆ í‘œì‹œ -->
                <span th:text="'#' + ${post.category.name}">#</span>

                <!--
                ë§Œì•½ BoardPostTag, BoardTagê¹Œì§€ ë‹¤ ì—°ê²°í–ˆìœ¼ë©´ ì˜ˆ:
                <span th:each="pt : ${boardPostTags}"
                      th:text="${'#' + pt.tag.name}">
                    #ì£¼ìˆ íšŒì „
                </span>
                -->
            </div>
        </section>

        <!-- ============ ëŒ“ê¸€ ì…ë ¥ ============ -->
        <section class="card comment-write-card">
            <div class="comment-write-title">
                ëŒ“ê¸€ (<span th:text="${commentList.size()}">0</span>)
            </div>

            <form th:action="@{'/board/' + ${memberId} + '/article/' + ${post.id} + '/comment/write.do'}"
                  method="post">

                <div class="comment-input-row">
                    <input name="content" type="text" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•´ ì£¼ì„¸ìš” :)">
                    <button type="submit">ëŒ“ê¸€ ë‹¬ê¸°</button>
                </div>
            </form>
            <style>
                .comment-list {
                    margin-top: 20px;
                }

                .comment-item {
                    border: 1px solid #ddd;
                    border-radius: 12px;
                    padding: 15px;
                    margin-bottom: 12px;
                    background: #fafafa;
                    transition: 0.2s;
                }

                .comment-item:hover {
                    background: #f0f0f0;
                }

                .comment-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 6px;
                }

                .comment-writer {
                    font-weight: 600;
                    color: #333;
                }

                .comment-date {
                    font-size: 13px;
                    color: #888;
                    margin-left: 10px;
                }

                .comment-delete-btn {
                    font-size: 13px;
                    color: #725bff;
                    text-decoration: none;
                    margin-left: 10px;
                }

                .comment-delete-btn:hover {
                    text-decoration: underline;
                }

                .comment-content {
                    font-size: 15px;
                    color: #444;
                    line-height: 1.4;
                    margin-top: 5px;
                    white-space: pre-wrap;
                }

                .comment-empty {
                    text-align: center;
                    padding: 20px;
                    color: #666;
                }
            </style>
            <!-- ============ ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ============ -->
            <div class="comment-list">

                <div th:if="${#lists.isEmpty(commentList)}"
                     class="comment-empty">
                    ë“±ë¡ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                </div>

                <div th:each="c : ${commentList}" class="comment-item">

                    <!-- ëŒ“ê¸€ ìƒë‹¨ (ë‹‰ë„¤ì„ + ë‚ ì§œ + ì‚­ì œ ë²„íŠ¼) -->
                    <div class="comment-header">
                        <span class="comment-writer" th:text="${c.member.nickname}">ë‹‰ë„¤ì„</span>

                        <span class="comment-date"
                              th:text="${c.createdAt}">2025-01-01</span>

                        <a th:href="@{'/board/' + ${memberId} + '/article/' + ${post.id} +
                        '/comment/' + ${c.id} + '/delete.do'}"
                           class="comment-delete-btn">
                            ì‚­ì œ
                        </a>
                    </div>

                    <!-- ëŒ“ê¸€ ë‚´ìš© -->
                    <div class="comment-content" th:text="${c.content}">
                        ëŒ“ê¸€ ë‚´ìš©
                    </div>

                </div>
            </div>
        </section>

    </div>
</div>


</body>
<script th:inline="javascript" layout:fragment="script">
    (function() {

        const likeBtn = document.getElementById("like-btn");
        const likeCountSpan = document.getElementById("like-count");

        // ì¢‹ì•„ìš” ë²„íŠ¼ì´ ì—†ìœ¼ë©´ ìŠ¤í¬ë¦½íŠ¸ ë°”ë¡œ ì¢…ë£Œ (ì•ˆì „)
        if (!likeBtn || !likeCountSpan) {
            return;
        }

        likeBtn.addEventListener("click", async () => {
            const postId = likeBtn.dataset.postId;
            const memberId = likeBtn.dataset.memberId;

            try {
                const res = await fetch(`/api/board-like/${postId}/toggle?memberId=${memberId}`, {
                    method: "POST",
                    headers: {
                        "X-Requested-With": "XMLHttpRequest"
                    }
                });

                if (!res.ok) {
                    console.error("like api error", res.status);
                    return;
                }

                const data = await res.json();   // { likeCount: ìˆ«ì, liked: boolean }

                // í™”ë©´ ê°±ì‹ 
                likeCountSpan.textContent = data.likeCount;
                likeBtn.dataset.liked = data.liked;
                likeBtn.classList.toggle("active", data.liked);

            } catch (e) {
                console.error("like toggle error", e);
            }
        });

        // ì²˜ìŒë¶€í„° ì¢‹ì•„ìš” ìƒíƒœë©´ active ì ìš©
        if (likeBtn.dataset.liked === "true") {
            likeBtn.classList.add("active");
        }

    })();
</script>

</html>