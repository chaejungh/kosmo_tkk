<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë”ì¿ ì¿  - ë•ì§ˆê²Œì‹œíŒ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link rel="stylesheet" th:href="@{/css/board.css}">

    <style>
        /* PC ì „ìš© ê¸€ì“°ê¸° ë²„íŠ¼ (ì˜¤ë¥¸ìª½ ì •ë ¬) */
        .desktop-write-btn {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
        }

        /* ëª¨ë°”ì¼ì—ì„œ PC ë²„íŠ¼ ìˆ¨ê¹€ */
        @media (max-width: 768px) {
            .desktop-write-btn {
                display: none;
            }
        }

        /* ëª¨ë°”ì¼ ì „ìš© í”Œë¡œíŒ… ë²„íŠ¼ */
        .floating-write-btn {
            position: fixed;
            right: 20px;
            bottom: 85px;
            width: 58px;
            height: 58px;
            border-radius: 50%;
            background: #6C4CF7;
            color: white;
            border: none;
            font-size: 34px;
            line-height: 58px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 999;
            cursor: pointer;
        }

        /* ì •ë ¬ ì•„ì´ì½˜ 3ê°œ ë¬¶ìŒ */
        .search-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;   /* ğŸ”¥ ì´ ë°•ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë©”ë‰´ê°€ ë–  */
        }

        /* ì •ë ¬ ë©”ë‰´(ìµœì‹ ìˆœ/ì¸ê¸°ìˆœ) - ë²„íŠ¼ ë°”ë¡œ ì•„ë˜ì— ëœ¨ê²Œ */
        .sort-menu {
            position: absolute;
            right: 0;
            top: calc(100% + 6px);   /* ğŸ”¥ ë²„íŠ¼ ì¤„ ì•„ë˜ë¡œ ì‚´ì§ ë„ìš°ê¸° */
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            padding: 6px 0;
            min-width: 90px;
            z-index: 10;
        }

        .sort-menu.hidden {
            display: none;
        }

        .sort-menu .sort-option {
            padding: 8px 14px;
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
        }

        .sort-menu .sort-option:hover {
            background: #f5f5f5;
        }

        .sort-menu .sort-option.active {
            background: #eee;
            font-weight: 700;
        }

        /* PC í™˜ê²½ì—ì„œëŠ” í”Œë¡œíŒ… ë²„íŠ¼ ìˆ¨ê¹€ */
        @media (min-width: 769px) {
            .floating-write-btn {
                display: none;
            }
        }
    </style>
</head>
<body>

<div class="page">

    <header class="header">
        <div class="header-top">
            <a th:href="@{/}" class="logo">ë”ì¿ ì¿ </a>
        </div>
    </header>

    <main class="content">

        <!-- ğŸ”¥ ì¸ê¸°ê¸€ TOP5 -->
        <section class="card hot-posts-card"
                 th:if="${not #lists.isEmpty(hotCurrentBoard) or not #lists.isEmpty(hotAllBoard)}">

            <div class="hot-posts-grid">

                <!-- ì™¼ìª½: í˜„ì¬ ê²Œì‹œíŒ ì¸ê¸°ê¸€ -->
                <div class="hot-posts-col">
                    <div class="hot-posts-col-header">
                        <div class="hot-posts-title">ì´ ê²Œì‹œíŒ ì¸ê¸°ê¸€</div>
                        <div class="hot-posts-subtabs">
                            <span class="hot-subtab active">ì˜¤ëŠ˜ BEST</span>
                        </div>
                    </div>

                    <ul class="hot-posts-list">
                        <li class="hot-post-item"
                            th:each="post : ${hotCurrentBoard}">
                        <span class="hot-post-label"
                              th:text="${post.category.name}">ì¹´í…Œê³ ë¦¬</span>

                            <a class="hot-post-link"
                               th:href="@{/mcboard/{memberId}/article/{postId}/detail.do(
                                    memberId=${memberId},
                                    postId=${post.id})}">
                            <span class="hot-post-title"
                                  th:text="${post.title}">
                                ì œëª©ì…ë‹ˆë‹¤
                            </span>
                                <span class="hot-post-comments"
                                      th:text="'[' + post.commentCount + ']'">[0]</span>
                            </a>
                        </li>

                        <li class="hot-post-empty"
                            th:if="${#lists.isEmpty(hotCurrentBoard)}">
                            ì´ ê²Œì‹œíŒì˜ ì¸ê¸°ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                        </li>
                    </ul>
                </div>

                <!-- ì˜¤ë¥¸ìª½: ì „ì²´ ê²Œì‹œíŒ ì¸ê¸°ê¸€ -->
                <div class="hot-posts-col">
                    <div class="hot-posts-col-header">
                        <div class="hot-posts-title">ì „ì²´ ê²Œì‹œíŒ ì¸ê¸°ê¸€</div>
                        <div class="hot-posts-subtabs">
                            <span class="hot-subtab active">ì˜¤ëŠ˜ BEST</span>
                        </div>
                    </div>

                    <ul class="hot-posts-list">
                        <li class="hot-post-item"
                            th:each="post : ${hotAllBoard}">
                        <span class="hot-post-label"
                              th:text="${post.category.name}">ì¹´í…Œê³ ë¦¬</span>

                            <a class="hot-post-link"
                               th:href="@{/mcboard/{memberId}/article/{postId}/detail.do(
                                    memberId=${memberId},
                                    postId=${post.id})}">
                            <span class="hot-post-title"
                                  th:text="${post.title}">
                                ì œëª©ì…ë‹ˆë‹¤
                            </span>
                                <span class="hot-post-comments"
                                      th:text="'[' + post.commentCount + ']'">[0]</span>
                            </a>
                        </li>

                        <li class="hot-post-empty"
                            th:if="${#lists.isEmpty(hotAllBoard)}">
                            ì „ì²´ ê²Œì‹œíŒ ì¸ê¸°ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                        </li>
                    </ul>
                </div>

            </div>
        </section>
        <section class="card board-header-card">
            <div class="card-header">
                <div class="card-title">
                    <span>ë•ì§ˆê²Œì‹œíŒ</span>
                    <span class="pill pill-purple">COMMUNITY</span>
                </div>
            </div>

            <div class="segmented-control">
                <button class="seg-btn active"
                        type="button"
                        th:onclick="|location.href='@{/mcboard/{memberId}/list.do(memberId=${memberId})}'|">ë‚´ ìƒˆë¼ ìë‘</button>
                <button class="seg-btn"
                        type="button"
                        th:onclick="|location.href='@{/cosplayboard/{memberId}/list.do(memberId=${memberId})}'|">
                    ì½”ìŠ¤í”„ë ˆ
                </button>
                <button class="seg-btn"
                        type="button"
                        th:onclick="|location.href='@{/freeboard/{memberId}/list.do(memberId=${memberId})}'|">ììœ ê²Œì‹œíŒ</button>
            </div>

            <div class="board-search-row">

                <div class="board-search-box">
                    <input type="text" placeholder="í†µí•© ê²€ìƒ‰ (ì œëª©, ë‹‰ë„¤ì„, íƒœê·¸)">
                    <span class="board-search-icon">ğŸ”</span>
                </div>

                <!-- â–¶â–¶ ì•„ì´ì½˜ ê¸°ëŠ¥ ì¶”ê°€ëœ ë¶€ë¶„ â—€â—€ -->
                <div class="search-actions">
                    <button id="viewListBtn" class="icon-btn active">â˜°</button>
                    <button id="viewPhotoBtn" class="icon-btn">â–¢</button>
                    <button id="sortBtn" class="icon-btn">â‡…</button>

                    <!-- ğŸ”¥ ì •ë ¬ ë©”ë‰´ë¥¼ search-actions ì•ˆìœ¼ë¡œ ì´ë™ -->
                    <div id="sortMenu" class="sort-menu hidden">
                        <div class="sort-option active" data-sort="latest">ìµœì‹ ìˆœ</div>
                        <div class="sort-option" data-sort="popular">ì¸ê¸°ìˆœ</div>
                    </div>
                </div>




                <!-- PCì—ì„œëŠ” ì˜¤ë¥¸ìª½ ëì— -->
                <div class="desktop-write-btn">
                    <button class="btn-primary btn-sm"
                            th:onclick="|location.href='@{/board/{memberId}/write(memberId=${memberId})}'|">
                        + ê¸€ì“°ê¸°
                    </button>
                </div>


            </div>

        </section>

        <!-- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ (ì›ë³¸ ê·¸ëŒ€ë¡œ) -->
        <!-- ì ˆëŒ€ ìˆ˜ì • ì•ˆ í–ˆìŒ -->

        <!-- ===== ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ ì¹´ë“œ ===== -->
        <section class="card">

            <!-- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ -->
            <ul class="post-list" th:if="${not #lists.isEmpty(posts)}">
                <li class="post-card"
                    th:each="post : ${posts}"
                    th:attr="data-post-id=${post.id}">
                    <!-- ì¸ë„¤ì¼ -->
                    <div class="post-thumb-box">
                        <span th:if="${post.thumbnailUrl == null}">IMAGE</span>
                        <img th:if="${post.thumbnailUrl != null}"
                             th:src="@{${post.thumbnailUrl}}"
                             alt="ì¸ë„¤ì¼"
                             style="width:100%; height:100%; object-fit:cover;">
                    </div>

                    <div class="post-main">
                        <div>
                            <!-- ì œëª© -->
                            <h3 class="post-title"
                                th:text="${post.title}">
                                ì˜¤ëŠ˜ ì˜ì—…ë‹¹í•œ ë‚´ ìµœì•  í¬ì¹´ ìë‘í•©ë‹ˆë‹¤ ğŸ¥¹
                            </h3>

                            <!-- ë‚´ìš© ìš”ì•½ (content ì•ë¶€ë¶„ ìë¥´ê¸°) -->
                            <p class="post-excerpt"
                               th:text="${#strings.abbreviate(post.content, 40)}">
                                ì˜¤ëŠ˜ ì˜ì—…ë‹¹í•œ ë‚´ ìµœì•  í¬ì¹´ ìë‘ ê¸€ì´ì—ìš”...
                            </p>

                            <!-- íƒœê·¸ëŠ” ë‚˜ì¤‘ì— DTOë¡œ í•©ì³ë„ ë˜ê³ , ì¼ë‹¨ì€ ì„ì‹œ -->
                            <p class="post-tag">
                                <!-- ì˜ˆì‹œ: ë‚˜ì¤‘ì— post.tagSummary ê°™ì€ í•„ë“œ ë§Œë“¤ë©´ ê·¸ê±¸ ì“°ë©´ ë¨ -->
                                <span th:text="${post.category.name}">#ì¹´í…Œê³ ë¦¬</span>
                            </p>

                            <!-- ë‹‰ë„¤ì„ Â· ì‘ì„±ì¼ -->
                            <p class="post-meta-top">
                                <span th:text="${post.member.nickname}">ë‹‰ë„¤ì„</span>
                                Â·
                                <span th:text="${#temporals.format(post.createdAt,'yyyy.MM.dd')}">
                            3ë¶„ ì „
                        </span>
                            </p>
                        </div>

                        <div class="post-meta-bottom">
                            <!-- â¤ï¸ì¢‹ì•„ìš” Â· ğŸ’¬ëŒ“ê¸€ìˆ˜ Â· ğŸ‘€ì¡°íšŒìˆ˜ -->
                            <div class="post-stats">
                                â¤ï¸<span th:text="${post.likeCount}">108</span>
                                Â· ğŸ’¬<span th:text="${post.commentCount}">23</span>
                                Â· ğŸ‘€<span th:text="${post.viewCount}">1,024</span>
                            </div>

                            <!-- ì¹´í…Œê³ ë¦¬ëª… -->
                            <div th:text="${post.category.name}">
                                ë‚´ ìƒˆë¼ ìë‘
                            </div>
                        </div>
                    </div>
                </li>
            </ul>

            <!-- ê¸€ì´ í•˜ë‚˜ë„ ì—†ì„ ë•Œ -->
            <p th:if="${#lists.isEmpty(posts)}" style="text-align:center; margin-top:40px;">
                ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
            </p>
        </section>


    </main>
</div>

<!-- ===== í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ===== -->
<nav class="bottom-nav">
    <a th:href="@{/}" class="nav-item">
        <span class="icon">ğŸ </span>
        <span>í™ˆ</span>
    </a>
    <a th:href="@{/board}" class="nav-item active">
        <span class="icon">ğŸ“</span>
        <span>ë•ì§ˆê²Œì‹œíŒ</span>
    </a>
    <a th:href="@{/trade}" class="nav-item">
        <span class="icon">ğŸ’¸</span>
        <span>êµ¿ì¦ˆê±°ë˜</span>
    </a>
    <a th:href="@{/mypage}" class="nav-item">
        <span class="icon">ğŸ‘¤</span>
        <span>ë‚´ì •ë³´</span>
    </a>
</nav>
<!-- ëª¨ë°”ì¼ ì „ìš© í”Œë¡œíŒ… ë²„íŠ¼ -->
<button class="floating-write-btn" onclick="location.href='/board/write'">ï¼‹</button>

<script th:inline="javascript">
    const postList = document.getElementById("postList");
    const viewListBtn = document.getElementById("viewListBtn");
    const viewPhotoBtn = document.getElementById("viewPhotoBtn");

    // íƒ€ì„ë¦¬í”„ì—ì„œ memberId ê°’ì„ JS ë³€ìˆ˜ë¡œ ì£¼ì…
    const memberId = /*[[${memberId}]]*/ 0;

    document.querySelectorAll('.post-card').forEach(card => {
        card.addEventListener('click', () => {
            const postId = card.dataset.postId;
            // ì›í•˜ëŠ” URL íŒ¨í„´ì— ë§ê²Œ ìˆ˜ì •í•´ì„œ ì‚¬ìš©
            // ì˜ˆ) /mcboard/{memberId}/{postId}/detail.do
            const url = `/mcboard/${memberId}/article/${postId}/detail.do`;
            window.location.href = url;
        });
    });
    /* ë¦¬ìŠ¤íŠ¸ ë³´ê¸° */
    viewListBtn.onclick = () => {
        postList.classList.remove("photo-view");
        viewListBtn.classList.add("active");
        viewPhotoBtn.classList.remove("active");
    };

    /* ì‚¬ì§„ ë³´ê¸° */
    viewPhotoBtn.onclick = () => {
        postList.classList.add("photo-view");
        viewPhotoBtn.classList.add("active");
        viewListBtn.classList.remove("active");
    };

    /* ===== ì •ë ¬ ë©”ë‰´ ê¸°ëŠ¥ ===== */
    const sortBtn = document.getElementById("sortBtn");      // ì•„ì´ì½˜ ë²„íŠ¼
    const sortMenu = document.getElementById("sortMenu");    // ë©”ë‰´ ë°•ìŠ¤
    const sortOptions = document.querySelectorAll(".sort-option");

    // ì •ë ¬ ë²„íŠ¼ í´ë¦­ â†’ ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°
    sortBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        sortMenu.classList.toggle("hidden");
    });

    // ì •ë ¬ ì˜µì…˜ í´ë¦­ â†’ ë©”ë‰´ ë‹«ê¸° + ì ìš©
    sortOptions.forEach(option => {
        option.addEventListener("click", () => {
            sortOptions.forEach(o => o.classList.remove("active"));
            option.classList.add("active");

            sortMenu.classList.add("hidden");

            console.log("ì •ë ¬:", option.dataset.sort);
        });
    });

    // í™”ë©´ í´ë¦­í•˜ë©´ ë‹«í˜
    document.addEventListener("click", () => {
        sortMenu.classList.add("hidden");
    });
</script>
</body>
</html>