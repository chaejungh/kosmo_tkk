<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ë‚´ ìƒˆë¼ ìë‘ ê¸€ì“°ê¸°</title>

    <style>
        /* ==== CSSëŠ” ê·¸ëŒ€ë¡œ ì‚¬ìš© ==== */
        :root {
            --purple: #6366f1;
            --purple-deep: #4f46e5;
            --border: #e5e7eb;
            --bg: #fafafa;
            --text-main: #111827;
            --text-sub: #6b7280;
        }
        * { box-sizing: border-box; }
        html, body {
            margin: 0; padding: 0; height: 100%;
            font-family: -apple-system, BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif;
            background: #f5f2ff;
        }
        .page-container {
            max-width: 1043px; margin: 0 auto; min-height: 100vh;
            background: #fdfdff; display: flex; flex-direction: column;
        }
        .write-header-bar {
            display: flex; align-items: center;
            padding: 16px 18px 8px;
        }
        .back-btn {
            border: none; background: transparent; font-size: 22px;
            cursor: pointer; padding: 4px 8px 4px 0;
        }
        .logo-text {
            flex: 1; text-align: center; font-weight: 700;
            font-size: 20px; color: #6C4CF7; margin-right: 30px;
        }
        .write-card {
            margin: 0 16px 18px; padding: 18px 16px 20px;
            background: #ffffff; border-radius: 18px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.04);
            flex: 1; display: flex; flex-direction: column;
        }

        .input-title,
        .textarea-content {
            width: 100%; border-radius: 12px;
            border: 1px solid #e1ddff; padding: 10px 12px;
            font-size: 14px; outline: none;
        }
        .input-title:focus,
        .textarea-content:focus {
            border-color: #6C4CF7;
            box-shadow: 0 0 0 2px rgba(108,76,247,0.12);
        }
        .textarea-content { resize: none; min-height: 180px; }
        .bottom-space { height: 10px; }
        .submit-wrap {
            margin-top: auto; padding-top: 12px;
            display: flex; justify-content: flex-end;
        }
        .submit-btn {
            border: none; border-radius: 999px;
            background: #6C4CF7; color: #ffffff;
            padding: 10px 28px; font-size: 15px;
            font-weight: 600; cursor: pointer;
            box-shadow: 0 6px 18px rgba(108,76,247,0.35);
        }
        .submit-btn:active {
            transform: translateY(1px);
            box-shadow: 0 3px 12px rgba(108,76,247,0.35);
        }
        @media (max-width: 480px) {
            .write-card {
                margin: 0 10px 16px;
                padding: 16px 14px 18px;
            }
        }

        .img-upload-box {
            background: #ffffff;
            border: 1px dashed var(--border);
            border-radius: 12px;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .img-upload-box:hover {
            border-color: var(--purple);
        }
        .img-preview-wrap {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .preview-item {
            position: relative;
        }

        .preview-img {
            width: 110px;
            height: 110px;
            object-fit: cover;
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        .remove-btn {
            position: absolute;
            top: -6px;
            right: -6px;
            background: rgba(0,0,0,0.7);
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 13px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .form-select{
            width: 10em;
        }
    </style>
</head>
<body>

<div class="page-container">

    <div class="write-header-bar">
        <button class="back-btn" type="button" onclick="history.back()">â†</button>
        <div class="logo-text">ë”ì¿ ì¿ </div>
    </div>

    <!-- âœ… ì—¬ê¸°ë¶€í„° í¼ -->
    <form class="write-card"
          th:action="${mode} == 'edit' ?
        @{/board/{memberId}/article/{postId}/edit.do(memberId=${memberId}, postId=${postId})} :
        @{/board/{memberId}/write(memberId=${memberId})}"
          method="post"
          enctype="multipart/form-data"
          th:object="${boardWriteValid}">

        <select class="form-select"
                aria-label="Default select example"
                name="categoryId"
                th:value="*{categoryId}"
                required
            >
            <option value="" disabled selected>ê²Œì‹œíŒ ì„ íƒ</option>
            <option value="1">ë‚´ ìƒˆë¼ ìë‘</option>
            <option value="2">ì½”ìŠ¤í”„ë ˆ</option>
            <option value="3">ììœ </option>
        </select>


        <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
        <div class="img-upload-box" onclick="document.getElementById('imgInput').click()">
            ğŸ“· í´ë¦­í•´ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œ (ì—¬ëŸ¬ ì¥ ê°€ëŠ¥)
        </div>

        <input type="file"
               id="imgInput"
               name="images"
               accept="image/*"
               multiple
               style="display:none">
        <div class="img-preview-wrap" id="previewArea"></div>

        <!-- ì œëª© -->
        <label class="form-label" for="title" >ì œëª©</label>
        <input
                th:value="*{title}"
                id="title"
                name="title"
                type="text"
                class="input-title"
                placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                required>
        <span th:if="${#fields.hasErrors('title')}" th:errors="*{title}" style="color:red"></span>


        <!-- ë‚´ìš© -->
        <label class="form-label" for="content">ê²Œì‹œê¸€ ë‚´ìš©</label>
        <textarea id="content"
                  name="content"
                  class="textarea-content"
                  placeholder="ê²Œì‹œê¸€ ë‚´ìš©ì„ ì‘ì„±í•´ì£¼ì„¸ìš” ğŸ˜Š" th:text="*{content}"
                  required></textarea>
        <span th:if="${#fields.hasErrors('content')}" th:errors="*{content}" style="color:red"></span>

        <div class="bottom-space"></div>

        <div class="submit-wrap">
            <!-- âœ… type="submit" ìœ¼ë¡œ ë³€ê²½ -->
            <button class="submit-btn" type="submit"
                    th:text="${mode} == 'edit' ? 'ê¸€ ìˆ˜ì •' : 'ê¸€ ë“±ë¡'">
                ê¸€ ë“±ë¡
            </button>

        </div>
    </form>
</div>

<script>
    const imgInput = document.getElementById("imgInput");
    const previewArea = document.getElementById("previewArea");

    let selectedFiles = [];

    imgInput.addEventListener("change", (e) => {
        const files = Array.from(e.target.files);
        selectedFiles = files;
        renderPreview();
    });

    function renderPreview() {
        previewArea.innerHTML = "";

        selectedFiles.forEach((file, idx) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const div = document.createElement("div");
                div.className = "preview-item";
                div.innerHTML = `
                    <img src="${e.target.result}" class="preview-img">
                    <div class="remove-btn" onclick="removeImg(${idx})">Ã—</div>
                `;
                previewArea.appendChild(div);
            };
            reader.readAsDataURL(file);
        });
    }

    function removeImg(index) {
        selectedFiles.splice(index, 1);

        const dt = new DataTransfer();
        selectedFiles.forEach(f => dt.items.add(f));
        imgInput.files = dt.files;

        renderPreview();
    }
</script>

</body>
</html>
