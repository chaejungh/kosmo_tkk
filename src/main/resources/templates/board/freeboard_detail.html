<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ìƒˆë¼ ìë‘ ìƒì„¸</title>

    <!-- ê³µí†µ ìŠ¤íƒ€ì¼ (ì´ë¯¸ ì“°ê³  ìˆëŠ” íŒŒì¼) -->
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link rel="stylesheet" th:href="@{/css/board.css}">

    <style>
        /* ================= ëª¨ë°”ì¼ ì „ìš© ë ˆì´ì•„ì›ƒ ================= */
        @media (max-width: 768px) {
            /* í˜ì´ì§€ ì „ì²´ë¥¼ ê°€ìš´ë° 1ì—´ë¡œ ë°°ì¹˜ (ëª¨ë°”ì¼ì¼ ë•Œë§Œ) */
            .page.board-page {
                min-height: 100vh;
                display: flex;
                justify-content: center;
            }

            .page.board-page .page-inner {
                width: 100%;
                max-width: 480px;          /* ëª¨ë°”ì¼ ê¸°ì¤€ í­ */
                margin: 0 auto;
                padding: 16px 12px 80px;   /* í•˜ë‹¨ ë„¤ë¹„ ë†’ì´ë§Œí¼ ì•„ë˜ ì—¬ë°± */
            }

            /* í•˜ë‹¨ ë„¤ë¹„ë„ ëª¨ë°”ì¼ì¼ ë•Œë§Œ í­ ì œí•œ + ê°€ìš´ë° ì •ë ¬ */
            .bottom-nav {
                position: fixed;
                left: 50%;
                transform: translateX(-50%);
                bottom: 0;
                width: 100%;
                max-width: 480px;
                background: #ffffff;
                border-top: 1px solid #eee;
                display: flex;
                justify-content: space-around;
                padding: 6px 0 8px;
                z-index: 50;
            }

            .bottom-nav .nav-item {
                flex: 1;
                text-align: center;
                font-size: 11px;
            }

            .bottom-nav .nav-item .icon {
                display: block;
                font-size: 18px;
                margin-bottom: 2px;
            }

            .bottom-nav .nav-item.active {
                color: #6C4CF7;
                font-weight: 600;
            }
        }

        /* ====== ì´ íŒŒì¼(ìƒì„¸í™”ë©´)ì—ì„œë§Œ ì“°ëŠ” ì¶”ê°€ ìŠ¤íƒ€ì¼ ====== */

        /* ìƒë‹¨ ì˜ì—­ */
        .detail-header-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 16px 18px 8px;
        }

        .detail-back-btn {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }

        .detail-logo {
            font-size: 20px;
            font-weight: 700;
            color: #6C4CF7;
        }

        /* ìƒì„¸ ì¹´ë“œ ì „ì²´ */
        .post-detail-card {
            margin-top: 8px;
        }

        /* í”„ë¡œí•„ ì˜ì—­ */
        .post-detail-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .detail-profile-photo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e5e5e5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: #777;
        }

        .detail-profile-meta {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .detail-nickname {
            font-size: 14px;
            font-weight: 600;
        }

        .detail-sub-meta {
            font-size: 11px;
            color: #999;
        }

        /* ëŒ€í‘œ ì´ë¯¸ì§€ ë°•ìŠ¤ */
        .detail-main-image {
            margin: 10px 0 14px;
            border-radius: 14px;
            background: #f5f5f5;
            height: 260px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            font-size: 13px;
            color: #999;
        }

        .detail-image-count {
            margin-top: 4px;
            font-size: 11px;
        }

        /* ì¢‹ì•„ìš”/ëŒ“ê¸€/ì €ì¥/ì¡°íšŒìˆ˜ + ê³µìœ  */
        .detail-stats-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 13px;
            margin-bottom: 10px;
        }

        .detail-stats-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .detail-stat-item {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .detail-share-btn {
            border: none;
            background: none;
            cursor: pointer;
            font-size: 18px;
        }

        /* ê¸€ ë‚´ìš© */
        .detail-content-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .detail-content-body {
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 6px;
        }

        .detail-content-tags {
            font-size: 12px;
            color: #6C4CF7;
            margin-bottom: 4px;
        }

        /* ëŒ“ê¸€ ì…ë ¥ ì˜ì—­ */
        .comment-write-card {
            margin-top: 14px;
        }

        .comment-write-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .comment-input-row {
            display: flex;
            gap: 8px;
        }

        .comment-input-row input {
            flex: 1;
            padding: 10px 12px;
            border-radius: 999px;
            border: 1px solid #ddd;
            font-size: 13px;
        }

        .comment-input-row button {
            padding: 0 16px;
            border-radius: 999px;
            border: none;
            background: #6C4CF7;
            color: #fff;
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
        }

        /* ëª¨ë°”ì¼ ê¸°ì¤€ ì¹´ë“œ ì•ˆ ì—¬ë°± ì¡°ê¸ˆ ì¤„ì´ê¸° */
        .post-detail-card .card-inner,
        .comment-write-card .card-inner {
            padding: 16px 18px;
        }

        /* card-innerê°€ ì—†ì„ ìˆ˜ë„ ìˆìœ¼ë‹ˆ ì•ˆì „í•˜ê²Œ */
        .post-detail-card,
        .comment-write-card {
            padding: 16px 18px;
        }

        @media (min-width: 769px) {
            .post-detail-card,
            .comment-write-card {
                padding: 22px 26px;
            }
        }

        .like-btn {
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            padding: 0 4px 0 0;
        }

        .like-btn.active {
            transform: scale(1.1);
        }
    </style>
</head>

<body>

<div class="page board-page">
    <div class="page-inner">

        <!-- ìƒë‹¨ ë¡œê³  + ë’¤ë¡œê°€ê¸° -->
        <header class="header">
            <div class="detail-header-bar">
                <button type="button"
                        class="detail-back-btn"
                        onclick="history.back()">
                    â†
                </button>
                <div class="detail-logo">ë”ì¿ ì¿ </div>
            </div>
        </header>

        <!-- ============ ìƒì„¸ ì¹´ë“œ ============ -->
        <section class="card post-detail-card">
            <div class="post-detail-header">
                <div class="detail-profile-photo">
                    <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì´ë¯¸ì§€, ì—†ìœ¼ë©´ 'í”„ë¡œí•„' ê¸€ì -->
                    <img th:if="${post.member.profileImageUrl} != null"
                         th:src="${post.member.profileImageUrl}"
                         alt="í”„ë¡œí•„"
                         style="width:40px; height:40px; border-radius:50%; object-fit:cover;" >
                    <span th:if="${post.member.profileImageUrl} == null">í”„ë¡œí•„</span>
                </div>
                <div class="detail-profile-meta">
                    <!-- ë‹‰ë„¤ì„ -->
                    <div class="detail-nickname"
                         th:text="${post.member.nickname}">
                    </div>
                    <!-- ì‘ì„±ì¼ Â· ì¹´í…Œê³ ë¦¬ëª… -->
                    <div class="detail-sub-meta">
                        <span th:text="${#temporals.format(post.createdAt, 'yyyy.MM.dd')}">
                        </span>
                        Â·
                        <span th:text="${post.category.name}">
                        </span>
                    </div>
                </div>
            </div>

            <!-- ëŒ€í‘œ ì‚¬ì§„ -->
            <div class="detail-main-image">
                <!-- thumbnailUrlì´ ìˆìœ¼ë©´ ëŒ€í‘œì‚¬ì§„ìœ¼ë¡œ ì‚¬ìš© -->
                <img th:if="${post.thumbnailUrl} != null"
                     th:src="${post.thumbnailUrl}"
                     alt="ëŒ€í‘œ ì‚¬ì§„"
                     style="width:100%; height:100%; object-fit:cover;">
                <div th:if="${post.thumbnailUrl} == null">
                    ëŒ€í‘œ ì‚¬ì§„ ì˜ì—­
                </div>

                <!-- ì´ë¯¸ì§€ ê°œìˆ˜ëŠ” ì¼ë‹¨ 1 / 1 -->
                <div class="detail-image-count">
                    <span>1 / 1</span>
                </div>
            </div>

            <!-- ì¢‹ì•„ìš” / ëŒ“ê¸€ / ì €ì¥ / ì¡°íšŒìˆ˜ + ê³µìœ  -->
            <div class="detail-stats-row">
                <div class="detail-stats-left">
                    <div class="detail-stat-item">
                        <button type="button"
                                id="like-btn"
                                class="like-btn"
                                th:data-post-id="${post.id}"
                                th:data-member-id="${memberId}"
                                th:data-liked="${likeInfo.id != null}">
                            â¤ï¸
                        </button>
                        <span id="like-count" th:text="${post.likeCount}">0</span>

                    </div>
                    <div class="detail-stat-item">
                        ğŸ’¬ <span th:text="${post.commentCount}">0</span>
                    </div>
                    <div class="detail-stat-item">
                        ğŸ“Œ <span>ì €ì¥</span>
                    </div>
                    <div class="detail-stat-item">
                        ğŸ‘€ <span th:text="${post.viewCount}">0</span>
                    </div>
                </div>
                <button type="button" class="detail-share-btn">ğŸ“¤</button>
            </div>

            <!-- ê¸€ ë‚´ìš© -->
            <div class="detail-content-title"
                 th:text="${post.title}">
            </div>

            <!-- ê°œí–‰ ë³´ì¡´: \n â†’ <br> -->
            <div class="detail-content-body"
                 th:utext="${#strings.replace(post.content, '\n', '<br/>')}">
                ì˜¤ëŠ˜ ì˜ì—…ë‹¹í•œ ë‚´ ìµœì•  í¬ì¹´ ìë‘ ê¸€ì´ì—ìš”.
                ì‹¤ë¬¼ì´ í›¨ì”¬ ì˜ˆì˜ê³ , ì‚¬ì§„ìœ¼ë¡œëŠ” ë‹¤ ì•ˆ ë‹´ê¸°ëŠ” ëŠë‚Œâ€¦
                ê°™ì€ ë•í›„ ë¶„ë“¤ê³¼ ê°™ì´ ê³µìœ í•˜ê³  ì‹¶ì–´ì„œ ì˜¬ë ¤ìš”!
            </div>

            <!-- íƒœê·¸ -->
            <div class="detail-content-tags">
                <!-- ì¼ë‹¨ ì¹´í…Œê³ ë¦¬ë§Œ ê°„ë‹¨íˆ í‘œì‹œ -->
                <span th:text="'#' + ${post.category.name}">#</span>

                <!--
                ë§Œì•½ BoardPostTag, BoardTagê¹Œì§€ ë‹¤ ì—°ê²°í–ˆìœ¼ë©´ ì˜ˆ:
                <span th:each="pt : ${boardPostTags}"
                      th:text="${'#' + pt.tag.name}">
                    #ì£¼ìˆ íšŒì „
                </span>
                -->
            </div>
        </section>

        <!-- ============ ëŒ“ê¸€ ì…ë ¥ ============ -->
        <section class="card comment-write-card">
            <div class="comment-write-title">
                ëŒ“ê¸€ (<span th:text="${post.commentCount}">0</span>)
            </div>
            <div class="comment-input-row">
                <input type="text" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•´ ì£¼ì„¸ìš” :)">
                <button type="button">ëŒ“ê¸€ ë‹¬ê¸°</button>
            </div>
        </section>

    </div>
</div>

<!-- í•˜ë‹¨ ë„¤ë¹„ (ê¸°ì¡´ì´ë‘ ë™ì¼í•˜ê²Œ) -->
<nav class="bottom-nav">
    <a th:href="@{/}" class="nav-item">
        <span class="icon">ğŸ </span><span>í™ˆ</span>
    </a>
    <a th:href="@{/board}" class="nav-item active">
        <span class="icon">ğŸ“</span><span>ë•ì§ˆê²Œì‹œíŒ</span>
    </a>
    <a th:href="@{/trade}" class="nav-item">
        <span class="icon">ğŸ’¸</span><span>êµ¿ì¦ˆê±°ë˜</span>
    </a>
    <a th:href="@{/mypage}" class="nav-item">
        <span class="icon">ğŸ‘¤</span><span>ë‚´ì •ë³´</span>
    </a>
</nav>

</body>
<script th:inline="javascript">
    (function() {

        const likeBtn = document.getElementById("like-btn");
        const likeCountSpan = document.getElementById("like-count");

        // ì¢‹ì•„ìš” ë²„íŠ¼ì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ë°”ë¡œ ì¢…ë£Œ
        if (!likeBtn || !likeCountSpan) {
            return;
        }

        likeBtn.addEventListener("click", async () => {
            const postId = likeBtn.dataset.postId;
            const memberId = likeBtn.dataset.memberId;

            try {
                const res = await fetch(`/api/board-like/${postId}/toggle?memberId=${memberId}`, {
                    method: "POST",
                    headers: {
                        "X-Requested-With": "XMLHttpRequest"
                    }
                });

                if (!res.ok) {
                    console.error("like api error", res.status);
                    return;
                }

                const data = await res.json();   // { likeCount: ìˆ«ì, liked: boolean }

                // í™”ë©´ ê°±ì‹ 
                likeCountSpan.textContent = data.likeCount;
                likeBtn.dataset.liked = data.liked;
                likeBtn.classList.toggle("active", data.liked);
            } catch (e) {
                console.error("like toggle error", e);
            }
        });

        // ì²˜ìŒ ë¡œë”© ì‹œ ì´ë¯¸ ì¢‹ì•„ìš” ìƒíƒœë©´ active ì ìš©
        if (likeBtn.dataset.liked === "true") {
            likeBtn.classList.add("active");
        }

    })();
</script>


</html>
