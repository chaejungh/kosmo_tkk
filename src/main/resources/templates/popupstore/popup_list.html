<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/tkk_fragment/layout}">

<head>
    <th:block layout:fragment="head"></th:block>
</head>

<body>
<div layout:fragment="content">

    <section class="card popup-page">
        <div class="popup-page-head">
            <div>
                <h2 class="popup-page-title">μ§„ν–‰μ¤‘μΈ νμ—…μ¤ν† μ–΄</h2>
                <p class="popup-page-sub">μ§€κΈ λ°©λ¬Έν•  μ μλ” νμ—…μ¤ν† μ–΄λ¥Ό ν™•μΈν•μ„Έμ”! π‰</p>
            </div>
        </div>

        <!-- κ²€μƒ‰/μ •λ ¬ -->
        <form class="popup-toolbar" method="get" th:action="@{/popup/list}">
            <div class="popup-search">
                <span class="popup-search-ico">π”</span>
                <input class="popup-search-input"
                       type="text"
                       name="q"
                       placeholder="νμ—…μ¤ν† μ–΄ κ²€μƒ‰ (μ λ©, μ„μΉ)"
                       th:value="${param.q}">
            </div>

            <input type="hidden" id="sort" name="sort" th:value="${param.sort ?: 'recent'}"/>

            <div class="popup-sort">
                <button type="button" class="popup-sort-btn" data-sort="recent">μµμ‹ μ</button>
                <button type="button" class="popup-sort-btn" data-sort="popular">μΈκΈ°μ</button>
            </div>
        </form>

        <!-- μΉ΄μ΄νΈ(μμΌλ©΄ ν‘μ‹) -->
        <div class="popup-count" th:if="${total != null}">
            μ΄ <b th:text="${total}">0</b>κ°μ νμ—…μ¤ν† μ–΄κ°€ μ§„ν–‰μ¤‘μ…λ‹λ‹¤
        </div>

        <!-- μΉ΄λ“ κ·Έλ¦¬λ“ -->
        <div class="popup-grid" th:if="${popups != null and !#lists.isEmpty(popups)}">
            <article class="popup-card" th:each="p : ${popups}">
                <a class="popup-card-link" th:href="@{/popup/{id}(id=${p.popupId})}">

                    <div class="popup-card-img"
                         th:style="|background-image:url('${p.bannerImageUrl}');|">
                        <span class="popup-card-badge-left">POP-UP</span>

                        <!-- status: ongoing/upcoming/ended -->
                        <span class="popup-card-badge-right"
                              th:classappend="${p.status} == 'ONGOING' ? ' ongoing' : (${p.status} == 'UPCOMING' ? ' upcoming' : ' ended')">
              <span class="popup-dot"></span>
              <span th:text="${p.statusLabel}">μ§„ν–‰μ¤‘</span>
            </span>
                    </div>

                    <div class="popup-card-body">
                        <h3 class="popup-card-title" th:text="${p.title}">νμ—… μ λ©</h3>

                        <div class="popup-card-meta">
                            <div class="meta-row">π“ <span th:text="${p.placeName}">μ¥μ†λ…</span></div>
                            <div class="meta-row">π“…
                                <span th:text="${#temporals.format(p.startDate,'yyyy.MM.dd')}">2025.01.01</span>
                                -
                                <span th:text="${#temporals.format(p.endDate,'yyyy.MM.dd')}">2025.02.01</span>
                            </div>
                        </div>

                        <div class="popup-card-stats">
                            <span>μ΅°ν <b th:text="${p.viewCount}">0</b></span>
                            <span>β¤ <b th:text="${p.likeCount}">0</b></span>
                        </div>

                        <div class="popup-card-btn">μμ„Έν λ³΄κΈ°</div>
                    </div>

                </a>
            </article>
        </div>

        <!-- λΉ„μ—μ„ λ• -->
        <div class="popup-empty" th:if="${popups == null or #lists.isEmpty(popups)}">
            μ•„μ§ λ“±λ΅λ νμ—…μ¤ν† μ–΄κ°€ μ—†μ–΄μ”. (μ΄λ―Έμ§€ URLλ§ λ„£μΌλ©΄ λ°”λ΅ μμκ² λ‚μ™€μ”!)
        </div>

    </section>

</div>

<th:block layout:fragment="script">
    <script>
        (function () {
            const sortInput = document.getElementById('sort');
            const form = document.querySelector('.popup-toolbar');
            const current = (sortInput && sortInput.value) ? sortInput.value : 'recent';

            document.querySelectorAll('.popup-sort-btn').forEach(btn => {
                if (btn.dataset.sort === current) btn.classList.add('active');

                btn.addEventListener('click', () => {
                    sortInput.value = btn.dataset.sort;
                    form.submit();
                });
            });
        })();
    </script>
</th:block>

</body>
</html>